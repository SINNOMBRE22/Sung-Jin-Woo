const a0_0xd39b39=a0_0x51c6;(function(_0x3350e5,_0x130491){const _0x4b9942=a0_0x51c6,_0x24426b=_0x3350e5();while(!![]){try{const _0x1fac06=parseInt(_0x4b9942(0x156))/0x1+parseInt(_0x4b9942(0x142))/0x2*(-parseInt(_0x4b9942(0x167))/0x3)+-parseInt(_0x4b9942(0x150))/0x4*(-parseInt(_0x4b9942(0x120))/0x5)+-parseInt(_0x4b9942(0x12a))/0x6*(parseInt(_0x4b9942(0x133))/0x7)+-parseInt(_0x4b9942(0x15a))/0x8+parseInt(_0x4b9942(0x13e))/0x9*(-parseInt(_0x4b9942(0x14a))/0xa)+parseInt(_0x4b9942(0x155))/0xb;if(_0x1fac06===_0x130491)break;else _0x24426b['push'](_0x24426b['shift']());}catch(_0x1294ff){_0x24426b['push'](_0x24426b['shift']());}}}(a0_0x4b37,0x5b179));import{dirname}from'path';import{fileURLToPath}from'url';import*as a0_0x1751ab from'fs';import*as a0_0x3c25f4 from'path';import*as a0_0x4e24bd from'crypto';import{ffmpeg}from'./converter.js';import a0_0x558626 from'fluent-ffmpeg';import{spawn}from'child_process';import a0_0x1266a9 from'./uploadFile.js';function a0_0x51c6(_0x10ff9c,_0x42588d){const _0x4b37e1=a0_0x4b37();return a0_0x51c6=function(_0x51c638,_0x3c3c6e){_0x51c638=_0x51c638-0x11b;let _0x37060d=_0x4b37e1[_0x51c638];return _0x37060d;},a0_0x51c6(_0x10ff9c,_0x42588d);}import a0_0x48004f from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import a0_0x58cfac from'node-webpmux';import a0_0x4ad1fa from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta[a0_0xd39b39(0x126)])),tmp=a0_0x3c25f4['join'](__dirname,a0_0xd39b39(0x153));function sticker2(_0xf6bca0,_0x53bcc6){return new Promise(async(_0xc84983,_0x176aec)=>{const _0xcc3357=a0_0x51c6;try{if(_0x53bcc6){const _0x5209c=await a0_0x4ad1fa(_0x53bcc6);if(_0x5209c['status']!==0xc8)throw await _0x5209c[_0xcc3357(0x160)]();_0xf6bca0=await _0x5209c[_0xcc3357(0x139)]();}const _0x4e4fa9=a0_0x3c25f4[_0xcc3357(0x14e)](tmp,+new Date()+_0xcc3357(0x11f));await a0_0x1751ab[_0xcc3357(0x148)][_0xcc3357(0x14c)](_0x4e4fa9,_0xf6bca0);const _0x370679=spawn('ffmpeg',['-y','-i',_0x4e4fa9,_0xcc3357(0x135),_0xcc3357(0x144),'-f',_0xcc3357(0x15c),'-']);_0x370679['on'](_0xcc3357(0x125),_0x176aec),_0x370679['on']('close',async()=>{const _0x5da152=_0xcc3357;await a0_0x1751ab[_0x5da152(0x148)]['unlink'](_0x4e4fa9);});const _0x31e459=[],[_0x2480a8,..._0x2afb2a]=[...module[_0xcc3357(0x11b)][_0xcc3357(0x127)]['gm']?['gm']:module[_0xcc3357(0x11b)][_0xcc3357(0x145)]?['magick']:[],_0xcc3357(0x161),_0xcc3357(0x154),_0xcc3357(0x14d)],_0xabead8=spawn(_0x2480a8,_0x2afb2a);_0xabead8['on']('error',_0x425aab=>conn[_0xcc3357(0x131)](m[_0xcc3357(0x12d)],util[_0xcc3357(0x162)](_0x425aab),m)),_0xabead8['stdout']['on']('data',_0x4ae827=>_0x31e459['push'](_0x4ae827)),_0x370679[_0xcc3357(0x124)][_0xcc3357(0x143)](_0xabead8[_0xcc3357(0x16a)]),_0xabead8['on']('exit',()=>{const _0x2ee460=_0xcc3357;_0xc84983(Buffer[_0x2ee460(0x121)](_0x31e459));});}catch(_0x43a5c4){_0x176aec(_0x43a5c4);}});}async function sticker3(_0x45a5fa,_0x5d1e44,_0x3c3135,_0x67db47){const _0x57d7a9=a0_0xd39b39;_0x5d1e44=_0x5d1e44?_0x5d1e44:await a0_0x1266a9(_0x45a5fa);const _0x407ca8=await a0_0x4ad1fa(_0x57d7a9(0x14b)+new URLSearchParams(Object[_0x57d7a9(0x15b)]({'url':_0x5d1e44,'packname':_0x3c3135,'author':_0x67db47})));return await _0x407ca8['buffer']();}async function sticker4(_0x1e232a,_0x387dfe){const _0x3cf0a8=a0_0xd39b39;if(_0x387dfe){const _0x509db0=await a0_0x4ad1fa(_0x387dfe);if(_0x509db0[_0x3cf0a8(0x165)]!==0xc8)throw await _0x509db0[_0x3cf0a8(0x160)]();_0x1e232a=await _0x509db0[_0x3cf0a8(0x139)]();}return await ffmpeg(_0x1e232a,[_0x3cf0a8(0x135),_0x3cf0a8(0x144)],_0x3cf0a8(0x149),_0x3cf0a8(0x147));}async function sticker5(_0x421150,_0x49bd6c,_0x310a54,_0x51cb87,_0x4d7dd5=[''],_0x5a68f6={}){const _0x1a783a=a0_0xd39b39,{Sticker:_0x5301a2}=await import('wa-sticker-formatter'),_0x2a688d={'type':_0x1a783a(0x12f),'pack':_0x310a54,'author':_0x51cb87,'categories':_0x4d7dd5,..._0x5a68f6};return new _0x5301a2(_0x421150?_0x421150:_0x49bd6c,_0x2a688d)[_0x1a783a(0x15f)]();}function sticker6(_0x9c97,_0x2abf0c){return new Promise(async(_0x1d1a78,_0x1b7bc0)=>{const _0x519f9a=a0_0x51c6;if(_0x2abf0c){const _0x53592b=await a0_0x4ad1fa(_0x2abf0c);if(_0x53592b[_0x519f9a(0x165)]!==0xc8)throw await _0x53592b[_0x519f9a(0x160)]();_0x9c97=await _0x53592b['buffer']();}const _0x23f0c5=await fileTypeFromBuffer(_0x9c97)||{'mime':_0x519f9a(0x146),'ext':_0x519f9a(0x134)};if(_0x23f0c5[_0x519f9a(0x122)]==_0x519f9a(0x134))_0x1b7bc0(_0x9c97);const _0x5aa240=a0_0x3c25f4[_0x519f9a(0x14e)](__dirname,'../tmp/'+ +new Date()+'.'+_0x23f0c5['ext']),_0x1c612f=a0_0x3c25f4[_0x519f9a(0x14e)](_0x5aa240+_0x519f9a(0x13a));await a0_0x1751ab[_0x519f9a(0x148)][_0x519f9a(0x14c)](_0x5aa240,_0x9c97);const _0x158aa9=/video/i[_0x519f9a(0x140)](_0x23f0c5[_0x519f9a(0x13f)])?a0_0x558626(_0x5aa240)[_0x519f9a(0x16b)](_0x23f0c5[_0x519f9a(0x122)]):a0_0x558626(_0x5aa240)[_0x519f9a(0x128)](_0x5aa240);_0x158aa9['on']('error',function(_0x5bf873){const _0x1feb18=_0x519f9a;console[_0x1feb18(0x125)](_0x5bf873),a0_0x1751ab['promises'][_0x1feb18(0x15e)](_0x5aa240),_0x1b7bc0(_0x9c97);})['on'](_0x519f9a(0x11c),async function(){const _0x27402d=_0x519f9a;a0_0x1751ab[_0x27402d(0x148)]['unlink'](_0x5aa240),_0x1d1a78(await a0_0x1751ab[_0x27402d(0x148)][_0x27402d(0x157)](_0x1c612f));})['addOutputOptions']([_0x519f9a(0x123),_0x519f9a(0x15d),_0x519f9a(0x135),'scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse'])[_0x519f9a(0x151)](_0x519f9a(0x147))[_0x519f9a(0x13d)](_0x1c612f);});}async function addExif(_0x374a4d,_0x3913d2,_0x518ecb,_0x15b04d=[''],_0xfb96ff){const _0x7c4e19=a0_0xd39b39,_0x3af29a=new a0_0x58cfac[(_0x7c4e19(0x13c))](),_0x32aa79=_0x7c4e19(0x166)+a0_0x4e24bd['randomBytes'](0xc)[_0x7c4e19(0x132)](_0x7c4e19(0x12b))[_0x7c4e19(0x14f)](),_0x2fc33a={'sticker-pack-id':_0xfb96ff['packId']?_0xfb96ff[_0x7c4e19(0x129)]:''+_0x32aa79,'sticker-pack-name':_0x3913d2?_0x3913d2:undefined,'sticker-pack-publisher':_0x518ecb?_0x518ecb:undefined,'android-app-store-link':_0xfb96ff['androidAppStoreLink']?_0xfb96ff['androidAppStoreLink']:undefined,'ios-app-store-link':_0xfb96ff[_0x7c4e19(0x12c)]?_0xfb96ff[_0x7c4e19(0x12c)]:undefined,'is-ai-sticker':_0xfb96ff[_0x7c4e19(0x152)]?0x1:undefined,'is-first-party-sticker':_0xfb96ff[_0x7c4e19(0x141)]?0x1:undefined,'accessibility-text':_0xfb96ff['accessibilityText']?_0xfb96ff[_0x7c4e19(0x11e)]:undefined,'avatar-sticker-template-id':_0xfb96ff[_0x7c4e19(0x168)]?_0xfb96ff[_0x7c4e19(0x168)]:undefined,'is-avatar-sticker':_0xfb96ff[_0x7c4e19(0x159)]?0x1:undefined,'sticker-maker-source-type':_0xfb96ff['stickerMakerSourceType']?_0xfb96ff['stickerMakerSourceType']:undefined,'emojis':_0x15b04d?_0x15b04d:undefined},_0x4a7d8e=Buffer[_0x7c4e19(0x164)]([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x50f380=Buffer[_0x7c4e19(0x164)](JSON[_0x7c4e19(0x169)](_0x2fc33a),_0x7c4e19(0x136)),_0x2a2231=Buffer[_0x7c4e19(0x121)]([_0x4a7d8e,_0x50f380]);return _0x2a2231[_0x7c4e19(0x137)](_0x50f380[_0x7c4e19(0x163)],0xe,0x4),await _0x3af29a[_0x7c4e19(0x13b)](_0x374a4d),_0x3af29a['exif']=_0x2a2231,await _0x3af29a[_0x7c4e19(0x13d)](null);}async function sticker(_0xfd3a0d,_0xc8b4cc,..._0x414b32){const _0x42799b=a0_0xd39b39;let _0x13c0f5,_0xa0b141;for(const _0x28646e of[sticker3,global[_0x42799b(0x127)]['ffmpeg']&&sticker6,sticker5,global[_0x42799b(0x127)]['ffmpeg']&&global[_0x42799b(0x127)][_0x42799b(0x12e)]&&sticker4,global[_0x42799b(0x127)][_0x42799b(0x158)]&&(global[_0x42799b(0x127)][_0x42799b(0x161)]||global[_0x42799b(0x127)]['magick']||global[_0x42799b(0x127)]['gm'])&&sticker2][_0x42799b(0x11d)](_0x21f248=>_0x21f248)){try{_0xa0b141=await _0x28646e(_0xfd3a0d,_0xc8b4cc,..._0x414b32);if(_0xa0b141[_0x42799b(0x130)](_0x42799b(0x138)))continue;if(_0xa0b141[_0x42799b(0x130)]('WEBP'))try{return await addExif(_0xa0b141,..._0x414b32);}catch(_0x21f643){return console['error'](_0x21f643),_0xa0b141;}throw _0xa0b141[_0x42799b(0x132)]();}catch(_0x2c74ae){_0x13c0f5=_0x2c74ae;continue;}}return console[_0x42799b(0x125)](_0x13c0f5),_0x13c0f5;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};function a0_0x4b37(){const _0x58bbac=['toString','267533oGGspm','bin','-vf','utf8','writeUIntLE','html','buffer','.webp','load','Image','save','18FnmxcD','mime','test','isFirstPartySticker','6fTVtFU','pipe','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','magick','application/octet-stream','webp','promises','jpeg','1270530xJiGhj','https://api.xteam.xyz/sticker/wm?','writeFile','webp:-','join','toUpperCase','211028CdAJwG','toFormat','isAiSticker','../tmp','png:-','15357760EqEUGj','580397thcJfW','readFile','ffmpeg','isAvatarSticker','5957560JjDnXB','entries','png','libwebp','unlink','toBuffer','text','convert','format','length','from','status','MYSTIC','553533YXRiIV','templateId','stringify','stdin','inputFormat','exports','end','filter','accessibilityText','.jpeg','35bNtrZy','concat','ext','-vcodec','stdout','error','url','support','input','packId','66GIbAwE','hex','iosAppStoreLink','chat','ffmpegWebp','default','includes','reply'];a0_0x4b37=function(){return _0x58bbac;};return a0_0x4b37();}