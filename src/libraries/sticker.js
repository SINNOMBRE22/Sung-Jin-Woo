const a0_0x398817=a0_0x3c6b;(function(_0x175f96,_0xcdecd8){const _0x188e6b=a0_0x3c6b,_0x3601c6=_0x175f96();while(!![]){try{const _0x924eeb=parseInt(_0x188e6b(0xe5))/0x1+-parseInt(_0x188e6b(0xd2))/0x2*(parseInt(_0x188e6b(0xf1))/0x3)+-parseInt(_0x188e6b(0xc6))/0x4*(-parseInt(_0x188e6b(0xfe))/0x5)+-parseInt(_0x188e6b(0xca))/0x6+parseInt(_0x188e6b(0xd3))/0x7+parseInt(_0x188e6b(0xc3))/0x8+-parseInt(_0x188e6b(0x100))/0x9;if(_0x924eeb===_0xcdecd8)break;else _0x3601c6['push'](_0x3601c6['shift']());}catch(_0x41f50b){_0x3601c6['push'](_0x3601c6['shift']());}}}(a0_0x3a7f,0xcc857));import{dirname}from'path';import{fileURLToPath}from'url';import*as a0_0x4246eb from'fs';import*as a0_0x43c7bd from'path';import*as a0_0x278a61 from'crypto';import{ffmpeg}from'./converter.js';function a0_0x3c6b(_0x217220,_0x32a0f4){const _0x3a7f81=a0_0x3a7f();return a0_0x3c6b=function(_0x3c6b79,_0x51ffa4){_0x3c6b79=_0x3c6b79-0xbe;let _0x21295e=_0x3a7f81[_0x3c6b79];return _0x21295e;},a0_0x3c6b(_0x217220,_0x32a0f4);}import a0_0x4d82f1 from'fluent-ffmpeg';import{spawn}from'child_process';import a0_0x5706f9 from'./uploadFile.js';import a0_0x49b718 from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import a0_0x2a9747 from'node-webpmux';import a0_0x3da258 from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta[a0_0x398817(0x107)])),tmp=a0_0x43c7bd[a0_0x398817(0xbe)](__dirname,a0_0x398817(0xce));function sticker2(_0x4073bb,_0xb8688e){return new Promise(async(_0x37e121,_0xa1cacf)=>{const _0x3df106=a0_0x3c6b;try{if(_0xb8688e){const _0xa47b46=await a0_0x3da258(_0xb8688e);if(_0xa47b46[_0x3df106(0xff)]!==0xc8)throw await _0xa47b46[_0x3df106(0xdb)]();_0x4073bb=await _0xa47b46[_0x3df106(0xc0)]();}const _0x5ae4cf=a0_0x43c7bd[_0x3df106(0xbe)](tmp,+new Date()+_0x3df106(0xef));await a0_0x4246eb[_0x3df106(0xfd)][_0x3df106(0xf5)](_0x5ae4cf,_0x4073bb);const _0x4ef56c=spawn('ffmpeg',['-y','-i',_0x5ae4cf,_0x3df106(0x10f),'scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','-f',_0x3df106(0xfa),'-']);_0x4ef56c['on'](_0x3df106(0xd9),_0xa1cacf),_0x4ef56c['on'](_0x3df106(0x10b),async()=>{const _0x1444d1=_0x3df106;await a0_0x4246eb[_0x1444d1(0xfd)][_0x1444d1(0xf3)](_0x5ae4cf);});const _0x5df7ef=[],[_0x11edf7,..._0x2b9730]=[...module[_0x3df106(0x103)][_0x3df106(0xf6)]['gm']?['gm']:module[_0x3df106(0x103)]['magick']?['magick']:[],_0x3df106(0xd7),_0x3df106(0xe6),_0x3df106(0xe1)],_0xb68ef4=spawn(_0x11edf7,_0x2b9730);_0xb68ef4['on'](_0x3df106(0xd9),_0x158c21=>conn[_0x3df106(0xe2)](m[_0x3df106(0xfc)],util[_0x3df106(0xdf)](_0x158c21),m)),_0xb68ef4['stdout']['on'](_0x3df106(0xc5),_0x485725=>_0x5df7ef[_0x3df106(0xc7)](_0x485725)),_0x4ef56c['stdout'][_0x3df106(0xeb)](_0xb68ef4[_0x3df106(0xe4)]),_0xb68ef4['on'](_0x3df106(0xe3),()=>{const _0xa8b408=_0x3df106;_0x37e121(Buffer[_0xa8b408(0xbf)](_0x5df7ef));});}catch(_0x4ada2a){_0xa1cacf(_0x4ada2a);}});}async function sticker3(_0x5b555c,_0x5966ff,_0x1b7802,_0x47c941){const _0x41a297=a0_0x398817;_0x5966ff=_0x5966ff?_0x5966ff:await a0_0x5706f9(_0x5b555c);const _0x20b421=await a0_0x3da258('https://api.xteam.xyz/sticker/wm?'+new URLSearchParams(Object[_0x41a297(0x108)]({'url':_0x5966ff,'packname':_0x1b7802,'author':_0x47c941})));return await _0x20b421[_0x41a297(0xc0)]();}async function sticker4(_0xd8e86a,_0x39515f){const _0x7ef42=a0_0x398817;if(_0x39515f){const _0xd383ad=await a0_0x3da258(_0x39515f);if(_0xd383ad[_0x7ef42(0xff)]!==0xc8)throw await _0xd383ad[_0x7ef42(0xdb)]();_0xd8e86a=await _0xd383ad[_0x7ef42(0xc0)]();}return await ffmpeg(_0xd8e86a,[_0x7ef42(0x10f),_0x7ef42(0xda)],'jpeg',_0x7ef42(0xcf));}async function sticker5(_0x56445f,_0x1c37d6,_0x2c1fb0,_0x43a2ab,_0x481fda=[''],_0xcbcf43={}){const _0x569b0e=a0_0x398817,{Sticker:_0x4762af}=await import(_0x569b0e(0x105)),_0x2f6c35={'type':_0x569b0e(0xfb),'pack':_0x2c1fb0,'author':_0x43a2ab,'categories':_0x481fda,..._0xcbcf43};return new _0x4762af(_0x56445f?_0x56445f:_0x1c37d6,_0x2f6c35)[_0x569b0e(0xee)]();}function sticker6(_0x1fa1d5,_0x19a005){return new Promise(async(_0x5e5fc4,_0x2a362b)=>{const _0x30297d=a0_0x3c6b;if(_0x19a005){const _0x358082=await a0_0x3da258(_0x19a005);if(_0x358082[_0x30297d(0xff)]!==0xc8)throw await _0x358082['text']();_0x1fa1d5=await _0x358082[_0x30297d(0xc0)]();}const _0x562b21=await fileTypeFromBuffer(_0x1fa1d5)||{'mime':_0x30297d(0xe9),'ext':_0x30297d(0xe8)};if(_0x562b21[_0x30297d(0xed)]==_0x30297d(0xe8))_0x2a362b(_0x1fa1d5);const _0x577171=a0_0x43c7bd[_0x30297d(0xbe)](__dirname,'../tmp/'+ +new Date()+'.'+_0x562b21[_0x30297d(0xed)]),_0x148eb5=a0_0x43c7bd['join'](_0x577171+_0x30297d(0x10a));await a0_0x4246eb[_0x30297d(0xfd)][_0x30297d(0xf5)](_0x577171,_0x1fa1d5);const _0x110ce5=/video/i[_0x30297d(0xc4)](_0x562b21[_0x30297d(0x10c)])?a0_0x4d82f1(_0x577171)[_0x30297d(0xf2)](_0x562b21['ext']):a0_0x4d82f1(_0x577171)[_0x30297d(0x104)](_0x577171);_0x110ce5['on']('error',function(_0x429f90){const _0x10d633=_0x30297d;console[_0x10d633(0xd9)](_0x429f90),a0_0x4246eb[_0x10d633(0xfd)][_0x10d633(0xf3)](_0x577171),_0x2a362b(_0x1fa1d5);})['on'](_0x30297d(0xcc),async function(){const _0x585afb=_0x30297d;a0_0x4246eb[_0x585afb(0xfd)][_0x585afb(0xf3)](_0x577171),_0x5e5fc4(await a0_0x4246eb['promises'][_0x585afb(0xc9)](_0x148eb5));})['addOutputOptions']([_0x30297d(0xec),'libwebp',_0x30297d(0x10f),_0x30297d(0xe0)])[_0x30297d(0xdd)]('webp')[_0x30297d(0xd4)](_0x148eb5);});}async function addExif(_0x2aece1,_0x5874df,_0x22d93d,_0x393fc6=[''],_0x5d12d3){const _0x491e25=a0_0x398817,_0x174ea8=new a0_0x2a9747[(_0x491e25(0x109))](),_0x1197b1=_0x491e25(0xde)+a0_0x278a61['randomBytes'](0xc)['toString'](_0x491e25(0xf0))[_0x491e25(0xc8)](),_0x4ca1ac={'sticker-pack-id':_0x5d12d3[_0x491e25(0xd1)]?_0x5d12d3[_0x491e25(0xd1)]:''+_0x1197b1,'sticker-pack-name':_0x5874df?_0x5874df:undefined,'sticker-pack-publisher':_0x22d93d?_0x22d93d:undefined,'android-app-store-link':_0x5d12d3['androidAppStoreLink']?_0x5d12d3['androidAppStoreLink']:undefined,'ios-app-store-link':_0x5d12d3[_0x491e25(0xf8)]?_0x5d12d3[_0x491e25(0xf8)]:undefined,'is-ai-sticker':_0x5d12d3['isAiSticker']?0x1:undefined,'is-first-party-sticker':_0x5d12d3[_0x491e25(0x102)]?0x1:undefined,'accessibility-text':_0x5d12d3['accessibilityText']?_0x5d12d3[_0x491e25(0x10d)]:undefined,'avatar-sticker-template-id':_0x5d12d3['templateId']?_0x5d12d3['templateId']:undefined,'is-avatar-sticker':_0x5d12d3[_0x491e25(0xcd)]?0x1:undefined,'sticker-maker-source-type':_0x5d12d3['stickerMakerSourceType']?_0x5d12d3[_0x491e25(0xea)]:undefined,'emojis':_0x393fc6?_0x393fc6:undefined},_0x31066c=Buffer[_0x491e25(0xd8)]([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x5a8f12=Buffer[_0x491e25(0xd8)](JSON[_0x491e25(0xcb)](_0x4ca1ac),_0x491e25(0x106)),_0x4575e7=Buffer[_0x491e25(0xbf)]([_0x31066c,_0x5a8f12]);return _0x4575e7[_0x491e25(0xe7)](_0x5a8f12[_0x491e25(0x10e)],0xe,0x4),await _0x174ea8[_0x491e25(0xc2)](_0x2aece1),_0x174ea8[_0x491e25(0xf7)]=_0x4575e7,await _0x174ea8[_0x491e25(0xd4)](null);}async function sticker(_0x1b2f33,_0x1affcc,..._0x3e3567){const _0x26e93a=a0_0x398817;let _0x58e21a,_0x58e53f;for(const _0x24784b of[sticker3,global[_0x26e93a(0xf6)][_0x26e93a(0x101)]&&sticker6,sticker5,global[_0x26e93a(0xf6)][_0x26e93a(0x101)]&&global['support'][_0x26e93a(0xf9)]&&sticker4,global[_0x26e93a(0xf6)][_0x26e93a(0x101)]&&(global[_0x26e93a(0xf6)][_0x26e93a(0xd7)]||global[_0x26e93a(0xf6)][_0x26e93a(0xdc)]||global['support']['gm'])&&sticker2][_0x26e93a(0xd0)](_0x266bf0=>_0x266bf0)){try{_0x58e53f=await _0x24784b(_0x1b2f33,_0x1affcc,..._0x3e3567);if(_0x58e53f[_0x26e93a(0xc1)](_0x26e93a(0xf4)))continue;if(_0x58e53f['includes'](_0x26e93a(0xd5)))try{return await addExif(_0x58e53f,..._0x3e3567);}catch(_0x3218c3){return console[_0x26e93a(0xd9)](_0x3218c3),_0x58e53f;}throw _0x58e53f[_0x26e93a(0xd6)]();}catch(_0x139986){_0x58e21a=_0x139986;continue;}}return console[_0x26e93a(0xd9)](_0x58e21a),_0x58e21a;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};function a0_0x3a7f(){const _0x2f08fd=['662OPcrZo','1524054NlcdNS','save','WEBP','toString','convert','from','error','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','text','magick','toFormat','MYSTIC','format','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse','webp:-','reply','exit','stdin','1387607fHXhZZ','png:-','writeUIntLE','bin','application/octet-stream','stickerMakerSourceType','pipe','-vcodec','ext','toBuffer','.jpeg','hex','6606uHgzUT','inputFormat','unlink','html','writeFile','support','exif','iosAppStoreLink','ffmpegWebp','png','default','chat','promises','785rmyWwM','status','21610215SWmRpQ','ffmpeg','isFirstPartySticker','exports','input','wa-sticker-formatter','utf8','url','entries','Image','.webp','close','mime','accessibilityText','length','-vf','join','concat','buffer','includes','load','11005264eCQvqY','test','data','40316pDOGhb','push','toUpperCase','readFile','3574044qldMWY','stringify','end','isAvatarSticker','../tmp','webp','filter','packId'];a0_0x3a7f=function(){return _0x2f08fd;};return a0_0x3a7f();}export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};