const a0_0x321549=a0_0x13d8;function a0_0x13d8(_0x18f4b8,_0x35d5f6){const _0x9ab27f=a0_0x9ab2();return a0_0x13d8=function(_0x13d8fa,_0x2649b0){_0x13d8fa=_0x13d8fa-0x100;let _0x197dd7=_0x9ab27f[_0x13d8fa];return _0x197dd7;},a0_0x13d8(_0x18f4b8,_0x35d5f6);}(function(_0x340b9f,_0xf21694){const _0x1f555f=a0_0x13d8,_0x1138a9=_0x340b9f();while(!![]){try{const _0x8dbd5d=parseInt(_0x1f555f(0x138))/0x1*(parseInt(_0x1f555f(0x10c))/0x2)+-parseInt(_0x1f555f(0x137))/0x3*(parseInt(_0x1f555f(0x101))/0x4)+parseInt(_0x1f555f(0x13c))/0x5+parseInt(_0x1f555f(0x11f))/0x6*(parseInt(_0x1f555f(0x145))/0x7)+parseInt(_0x1f555f(0x108))/0x8*(parseInt(_0x1f555f(0x128))/0x9)+-parseInt(_0x1f555f(0x107))/0xa+parseInt(_0x1f555f(0x130))/0xb*(-parseInt(_0x1f555f(0x13f))/0xc);if(_0x8dbd5d===_0xf21694)break;else _0x1138a9['push'](_0x1138a9['shift']());}catch(_0x76ef00){_0x1138a9['push'](_0x1138a9['shift']());}}}(a0_0x9ab2,0x1fe3a));import{dirname}from'path';import{fileURLToPath}from'url';import*as a0_0x310b80 from'fs';import*as a0_0x41cd5f from'path';import*as a0_0x31538f from'crypto';import{ffmpeg}from'./converter.js';import a0_0x5268ca from'fluent-ffmpeg';import{spawn}from'child_process';import a0_0x3cf74d from'./uploadFile.js';import a0_0x60809a from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import a0_0xb1b15a from'node-webpmux';import a0_0x48cea6 from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta[a0_0x321549(0x129)])),tmp=a0_0x41cd5f[a0_0x321549(0x125)](__dirname,a0_0x321549(0x105));function sticker2(_0x3f8a8e,_0x24052e){return new Promise(async(_0x499272,_0x45a19a)=>{const _0x51911d=a0_0x13d8;try{if(_0x24052e){const _0x566470=await a0_0x48cea6(_0x24052e);if(_0x566470[_0x51911d(0x119)]!==0xc8)throw await _0x566470['text']();_0x3f8a8e=await _0x566470[_0x51911d(0x123)]();}const _0x1795d7=a0_0x41cd5f[_0x51911d(0x125)](tmp,+new Date()+_0x51911d(0x142));await a0_0x310b80[_0x51911d(0x133)][_0x51911d(0x11b)](_0x1795d7,_0x3f8a8e);const _0x3fd2de=spawn(_0x51911d(0x12d),['-y','-i',_0x1795d7,_0x51911d(0x132),_0x51911d(0x104),'-f',_0x51911d(0x100),'-']);_0x3fd2de['on'](_0x51911d(0x146),_0x45a19a),_0x3fd2de['on'](_0x51911d(0x134),async()=>{const _0x1865e2=_0x51911d;await a0_0x310b80[_0x1865e2(0x133)]['unlink'](_0x1795d7);});const _0x595c36=[],[_0x409d,..._0x109dcf]=[...module[_0x51911d(0x136)][_0x51911d(0x118)]['gm']?['gm']:module[_0x51911d(0x136)][_0x51911d(0x141)]?[_0x51911d(0x141)]:[],_0x51911d(0x116),'png:-','webp:-'],_0x493fb1=spawn(_0x409d,_0x109dcf);_0x493fb1['on'](_0x51911d(0x146),_0x3b1c5c=>conn[_0x51911d(0x10f)](m[_0x51911d(0x110)],util['format'](_0x3b1c5c),m)),_0x493fb1[_0x51911d(0x131)]['on'](_0x51911d(0x11e),_0x4ecdcb=>_0x595c36[_0x51911d(0x135)](_0x4ecdcb)),_0x3fd2de[_0x51911d(0x131)]['pipe'](_0x493fb1[_0x51911d(0x112)]),_0x493fb1['on']('exit',()=>{const _0x46d9cc=_0x51911d;_0x499272(Buffer[_0x46d9cc(0x126)](_0x595c36));});}catch(_0x212e10){_0x45a19a(_0x212e10);}});}async function sticker3(_0x566b45,_0x139400,_0x24b753,_0xbfe43){const _0x5e92d2=a0_0x321549;_0x139400=_0x139400?_0x139400:await a0_0x3cf74d(_0x566b45);const _0x11c075=await a0_0x48cea6('https://api.xteam.xyz/sticker/wm?'+new URLSearchParams(Object[_0x5e92d2(0x103)]({'url':_0x139400,'packname':_0x24b753,'author':_0xbfe43})));return await _0x11c075[_0x5e92d2(0x123)]();}async function sticker4(_0x4482eb,_0x1dc00f){const _0x3bce40=a0_0x321549;if(_0x1dc00f){const _0xc551a8=await a0_0x48cea6(_0x1dc00f);if(_0xc551a8[_0x3bce40(0x119)]!==0xc8)throw await _0xc551a8[_0x3bce40(0x12f)]();_0x4482eb=await _0xc551a8['buffer']();}return await ffmpeg(_0x4482eb,['-vf',_0x3bce40(0x104)],_0x3bce40(0x102),_0x3bce40(0x127));}function a0_0x9ab2(){const _0x1c4183=['input','toString','accessibilityText','53200PtJGWn','hex','save','reply','chat','default','stdin','templateId','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse','ext','convert','isAiSticker','support','status','from','writeFile','includes','html','data','414rzyTkN','unlink','iosAppStoreLink','androidAppStoreLink','buffer','stickerMakerSourceType','join','concat','webp','9xrKjbe','url','-vcodec','end','../tmp/','ffmpeg','isFirstPartySticker','text','1177VvoJFs','stdout','-vf','promises','close','push','exports','639ewXrGj','7tFboCA','application/octet-stream','isAvatarSticker','length','295885GfqRWR','filter','writeUIntLE','19476oFkmJW','Image','magick','.jpeg','toUpperCase','packId','11235Yfjxti','error','stringify','png','256CpQXdS','jpeg','entries','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','../tmp','ffmpegWebp','1968320OIcOfJ','1268968XkXPcv'];a0_0x9ab2=function(){return _0x1c4183;};return a0_0x9ab2();}async function sticker5(_0x155b00,_0x5a0306,_0x47140b,_0x40fe59,_0xe34f99=[''],_0x24bbb8={}){const _0xa1fff5=a0_0x321549,{Sticker:_0xb8a2af}=await import('wa-sticker-formatter'),_0x3a104b={'type':_0xa1fff5(0x111),'pack':_0x47140b,'author':_0x40fe59,'categories':_0xe34f99,..._0x24bbb8};return new _0xb8a2af(_0x155b00?_0x155b00:_0x5a0306,_0x3a104b)['toBuffer']();}function sticker6(_0x5b5ec8,_0x34e582){return new Promise(async(_0x421ec6,_0x4667f0)=>{const _0x494237=a0_0x13d8;if(_0x34e582){const _0x31b6f7=await a0_0x48cea6(_0x34e582);if(_0x31b6f7[_0x494237(0x119)]!==0xc8)throw await _0x31b6f7['text']();_0x5b5ec8=await _0x31b6f7[_0x494237(0x123)]();}const _0x6d3138=await fileTypeFromBuffer(_0x5b5ec8)||{'mime':_0x494237(0x139),'ext':'bin'};if(_0x6d3138[_0x494237(0x115)]=='bin')_0x4667f0(_0x5b5ec8);const _0x428deb=a0_0x41cd5f[_0x494237(0x125)](__dirname,_0x494237(0x12c)+ +new Date()+'.'+_0x6d3138[_0x494237(0x115)]),_0x2c9f6e=a0_0x41cd5f[_0x494237(0x125)](_0x428deb+'.webp');await a0_0x310b80[_0x494237(0x133)][_0x494237(0x11b)](_0x428deb,_0x5b5ec8);const _0x17b64a=/video/i['test'](_0x6d3138['mime'])?a0_0x5268ca(_0x428deb)['inputFormat'](_0x6d3138[_0x494237(0x115)]):a0_0x5268ca(_0x428deb)[_0x494237(0x109)](_0x428deb);_0x17b64a['on'](_0x494237(0x146),function(_0x42386f){const _0x5c81c4=_0x494237;console[_0x5c81c4(0x146)](_0x42386f),a0_0x310b80[_0x5c81c4(0x133)][_0x5c81c4(0x120)](_0x428deb),_0x4667f0(_0x5b5ec8);})['on'](_0x494237(0x12b),async function(){const _0x45298a=_0x494237;a0_0x310b80[_0x45298a(0x133)][_0x45298a(0x120)](_0x428deb),_0x421ec6(await a0_0x310b80['promises']['readFile'](_0x2c9f6e));})['addOutputOptions']([_0x494237(0x12a),'libwebp','-vf',_0x494237(0x114)])['toFormat'](_0x494237(0x127))[_0x494237(0x10e)](_0x2c9f6e);});}async function addExif(_0x42030,_0x579668,_0x4532fd,_0x21da36=[''],_0x11c401){const _0x34e57d=a0_0x321549,_0x21a311=new a0_0xb1b15a[(_0x34e57d(0x140))](),_0x55ba10='MYSTIC'+a0_0x31538f['randomBytes'](0xc)[_0x34e57d(0x10a)](_0x34e57d(0x10d))[_0x34e57d(0x143)](),_0x46d05f={'sticker-pack-id':_0x11c401[_0x34e57d(0x144)]?_0x11c401[_0x34e57d(0x144)]:''+_0x55ba10,'sticker-pack-name':_0x579668?_0x579668:undefined,'sticker-pack-publisher':_0x4532fd?_0x4532fd:undefined,'android-app-store-link':_0x11c401[_0x34e57d(0x122)]?_0x11c401['androidAppStoreLink']:undefined,'ios-app-store-link':_0x11c401[_0x34e57d(0x121)]?_0x11c401[_0x34e57d(0x121)]:undefined,'is-ai-sticker':_0x11c401[_0x34e57d(0x117)]?0x1:undefined,'is-first-party-sticker':_0x11c401[_0x34e57d(0x12e)]?0x1:undefined,'accessibility-text':_0x11c401[_0x34e57d(0x10b)]?_0x11c401[_0x34e57d(0x10b)]:undefined,'avatar-sticker-template-id':_0x11c401['templateId']?_0x11c401[_0x34e57d(0x113)]:undefined,'is-avatar-sticker':_0x11c401[_0x34e57d(0x13a)]?0x1:undefined,'sticker-maker-source-type':_0x11c401[_0x34e57d(0x124)]?_0x11c401[_0x34e57d(0x124)]:undefined,'emojis':_0x21da36?_0x21da36:undefined},_0x483ec4=Buffer[_0x34e57d(0x11a)]([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x1f919b=Buffer[_0x34e57d(0x11a)](JSON[_0x34e57d(0x147)](_0x46d05f),'utf8'),_0xded4df=Buffer[_0x34e57d(0x126)]([_0x483ec4,_0x1f919b]);return _0xded4df[_0x34e57d(0x13e)](_0x1f919b[_0x34e57d(0x13b)],0xe,0x4),await _0x21a311['load'](_0x42030),_0x21a311['exif']=_0xded4df,await _0x21a311[_0x34e57d(0x10e)](null);}async function sticker(_0x4d2311,_0x1bf5c2,..._0x13adbb){const _0x2980cf=a0_0x321549;let _0xb2e7f,_0x19c3f7;for(const _0x18db47 of[sticker3,global['support']['ffmpeg']&&sticker6,sticker5,global[_0x2980cf(0x118)][_0x2980cf(0x12d)]&&global[_0x2980cf(0x118)][_0x2980cf(0x106)]&&sticker4,global[_0x2980cf(0x118)][_0x2980cf(0x12d)]&&(global[_0x2980cf(0x118)][_0x2980cf(0x116)]||global[_0x2980cf(0x118)][_0x2980cf(0x141)]||global[_0x2980cf(0x118)]['gm'])&&sticker2][_0x2980cf(0x13d)](_0x49fae7=>_0x49fae7)){try{_0x19c3f7=await _0x18db47(_0x4d2311,_0x1bf5c2,..._0x13adbb);if(_0x19c3f7[_0x2980cf(0x11c)](_0x2980cf(0x11d)))continue;if(_0x19c3f7[_0x2980cf(0x11c)]('WEBP'))try{return await addExif(_0x19c3f7,..._0x13adbb);}catch(_0x4fe2cb){return console[_0x2980cf(0x146)](_0x4fe2cb),_0x19c3f7;}throw _0x19c3f7[_0x2980cf(0x10a)]();}catch(_0x461d19){_0xb2e7f=_0x461d19;continue;}}return console['error'](_0xb2e7f),_0xb2e7f;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};