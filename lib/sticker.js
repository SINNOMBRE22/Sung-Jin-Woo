const a0_0x5a6558=a0_0x2fd5;(function(_0x23e962,_0x7ed01e){const _0x37eb97=a0_0x2fd5,_0x22bde0=_0x23e962();while(!![]){try{const _0x2985d5=parseInt(_0x37eb97(0x140))/0x1*(-parseInt(_0x37eb97(0x15c))/0x2)+parseInt(_0x37eb97(0x159))/0x3+parseInt(_0x37eb97(0x144))/0x4+-parseInt(_0x37eb97(0x131))/0x5*(parseInt(_0x37eb97(0x147))/0x6)+parseInt(_0x37eb97(0x13d))/0x7*(parseInt(_0x37eb97(0x116))/0x8)+-parseInt(_0x37eb97(0x15b))/0x9+-parseInt(_0x37eb97(0x158))/0xa;if(_0x2985d5===_0x7ed01e)break;else _0x22bde0['push'](_0x22bde0['shift']());}catch(_0x193e64){_0x22bde0['push'](_0x22bde0['shift']());}}}(a0_0x3476,0x77561));import{dirname}from'path';import{fileURLToPath}from'url';import*as a0_0x27e184 from'fs';import*as a0_0x20b3f2 from'path';import*as a0_0x1b5b2c from'crypto';import{ffmpeg}from'./converter.js';function a0_0x3476(){const _0x2b20f0=['ffmpeg','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','load','input','exit','text','readFile','androidAppStoreLink','utf8','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse','833792JdbtIZ','unlink','promises','support','randomBytes','bin','close','toString','save','.webp','.jpeg','png','inputFormat','WEBP','wa-sticker-formatter','hex','format','writeFile','webp','stdin','default','reply','png:-','from','isAvatarSticker','toFormat','writeUIntLE','5eOnxAL','isFirstPartySticker','stickerMakerSourceType','exif','-vcodec','jpeg','-vf','mime','stringify','application/octet-stream','packId','convert','63RgzcsF','isAiSticker','ffmpegWebp','6RJkPnE','end','filter','iosAppStoreLink','2728076kUljyM','magick','libwebp','368502hHUAMe','ext','accessibilityText','includes','join','buffer','MYSTIC','entries','concat','html','stdout','../tmp/','data','../tmp','length','url','status','12326020HMDUfN','2161776CfelAV','error','4110417SlpjFZ','33698YzkRPD'];a0_0x3476=function(){return _0x2b20f0;};return a0_0x3476();}import a0_0x2de331 from'fluent-ffmpeg';import{spawn}from'child_process';import a0_0x163fc7 from'./uploadFile.js';import a0_0x43a360 from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import a0_0x28a2e6 from'node-webpmux';import a0_0x16d519 from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta[a0_0x5a6558(0x156)])),tmp=a0_0x20b3f2['join'](__dirname,a0_0x5a6558(0x154));function sticker2(_0x12302c,_0xd79bb9){return new Promise(async(_0x592180,_0x26a9b1)=>{const _0x383393=a0_0x2fd5;try{if(_0xd79bb9){const _0x9479d2=await a0_0x16d519(_0xd79bb9);if(_0x9479d2[_0x383393(0x157)]!==0xc8)throw await _0x9479d2[_0x383393(0x111)]();_0x12302c=await _0x9479d2['buffer']();}const _0x127210=a0_0x20b3f2[_0x383393(0x14b)](tmp,+new Date()+_0x383393(0x120));await a0_0x27e184[_0x383393(0x118)][_0x383393(0x127)](_0x127210,_0x12302c);const _0x426c11=spawn(_0x383393(0x15d),['-y','-i',_0x127210,'-vf','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','-f',_0x383393(0x121),'-']);_0x426c11['on'](_0x383393(0x15a),_0x26a9b1),_0x426c11['on'](_0x383393(0x11c),async()=>{await a0_0x27e184['promises']['unlink'](_0x127210);});const _0x3a115=[],[_0x30775f,..._0x20e2ea]=[...module['exports'][_0x383393(0x119)]['gm']?['gm']:module['exports']['magick']?[_0x383393(0x145)]:[],'convert',_0x383393(0x12c),'webp:-'],_0x44a586=spawn(_0x30775f,_0x20e2ea);_0x44a586['on']('error',_0x5a2b50=>conn[_0x383393(0x12b)](m['chat'],util[_0x383393(0x126)](_0x5a2b50),m)),_0x44a586[_0x383393(0x151)]['on'](_0x383393(0x153),_0x17eeef=>_0x3a115['push'](_0x17eeef)),_0x426c11[_0x383393(0x151)]['pipe'](_0x44a586[_0x383393(0x129)]),_0x44a586['on'](_0x383393(0x110),()=>{const _0x66c181=_0x383393;_0x592180(Buffer[_0x66c181(0x14f)](_0x3a115));});}catch(_0x1bb8dc){_0x26a9b1(_0x1bb8dc);}});}async function sticker3(_0x23a46c,_0x53f62b,_0x481c4c,_0xb1ec8a){const _0x3555cc=a0_0x5a6558;_0x53f62b=_0x53f62b?_0x53f62b:await a0_0x163fc7(_0x23a46c);const _0x10f071=await a0_0x16d519('https://api.xteam.xyz/sticker/wm?'+new URLSearchParams(Object[_0x3555cc(0x14e)]({'url':_0x53f62b,'packname':_0x481c4c,'author':_0xb1ec8a})));return await _0x10f071[_0x3555cc(0x14c)]();}async function sticker4(_0x542ce0,_0x5e4839){const _0x38e464=a0_0x5a6558;if(_0x5e4839){const _0x4a2d56=await a0_0x16d519(_0x5e4839);if(_0x4a2d56['status']!==0xc8)throw await _0x4a2d56['text']();_0x542ce0=await _0x4a2d56[_0x38e464(0x14c)]();}return await ffmpeg(_0x542ce0,[_0x38e464(0x137),_0x38e464(0x15e)],_0x38e464(0x136),_0x38e464(0x128));}function a0_0x2fd5(_0x4b6111,_0x36362f){const _0x3476a4=a0_0x3476();return a0_0x2fd5=function(_0x2fd57c,_0x11aaba){_0x2fd57c=_0x2fd57c-0x10f;let _0x259bf0=_0x3476a4[_0x2fd57c];return _0x259bf0;},a0_0x2fd5(_0x4b6111,_0x36362f);}async function sticker5(_0x47dfec,_0x491bbe,_0x44eaf2,_0x135837,_0x3ec2b0=[''],_0x245193={}){const _0xd33734=a0_0x5a6558,{Sticker:_0xb87887}=await import(_0xd33734(0x124)),_0x325093={'type':_0xd33734(0x12a),'pack':_0x44eaf2,'author':_0x135837,'categories':_0x3ec2b0,..._0x245193};return new _0xb87887(_0x47dfec?_0x47dfec:_0x491bbe,_0x325093)['toBuffer']();}function sticker6(_0x1c22f6,_0x12946b){return new Promise(async(_0x2aac9a,_0x4499a3)=>{const _0x59ae45=a0_0x2fd5;if(_0x12946b){const _0x3c0a15=await a0_0x16d519(_0x12946b);if(_0x3c0a15['status']!==0xc8)throw await _0x3c0a15['text']();_0x1c22f6=await _0x3c0a15[_0x59ae45(0x14c)]();}const _0x5681ad=await fileTypeFromBuffer(_0x1c22f6)||{'mime':_0x59ae45(0x13a),'ext':_0x59ae45(0x11b)};if(_0x5681ad[_0x59ae45(0x148)]=='bin')_0x4499a3(_0x1c22f6);const _0x52ba4a=a0_0x20b3f2[_0x59ae45(0x14b)](__dirname,_0x59ae45(0x152)+ +new Date()+'.'+_0x5681ad['ext']),_0x7c20b0=a0_0x20b3f2[_0x59ae45(0x14b)](_0x52ba4a+_0x59ae45(0x11f));await a0_0x27e184[_0x59ae45(0x118)][_0x59ae45(0x127)](_0x52ba4a,_0x1c22f6);const _0xc7db37=/video/i['test'](_0x5681ad[_0x59ae45(0x138)])?a0_0x2de331(_0x52ba4a)[_0x59ae45(0x122)](_0x5681ad[_0x59ae45(0x148)]):a0_0x2de331(_0x52ba4a)[_0x59ae45(0x10f)](_0x52ba4a);_0xc7db37['on'](_0x59ae45(0x15a),function(_0x264414){const _0xa673b2=_0x59ae45;console[_0xa673b2(0x15a)](_0x264414),a0_0x27e184[_0xa673b2(0x118)][_0xa673b2(0x117)](_0x52ba4a),_0x4499a3(_0x1c22f6);})['on'](_0x59ae45(0x141),async function(){const _0x57512c=_0x59ae45;a0_0x27e184[_0x57512c(0x118)][_0x57512c(0x117)](_0x52ba4a),_0x2aac9a(await a0_0x27e184['promises'][_0x57512c(0x112)](_0x7c20b0));})['addOutputOptions']([_0x59ae45(0x135),_0x59ae45(0x146),_0x59ae45(0x137),_0x59ae45(0x115)])[_0x59ae45(0x12f)](_0x59ae45(0x128))[_0x59ae45(0x11e)](_0x7c20b0);});}async function addExif(_0xa7bead,_0x15ade0,_0x1a5745,_0x4155d9=[''],_0x40548d){const _0x130d47=a0_0x5a6558,_0x26c7c1=new a0_0x28a2e6['Image'](),_0x2747c4=_0x130d47(0x14d)+a0_0x1b5b2c[_0x130d47(0x11a)](0xc)['toString'](_0x130d47(0x125))['toUpperCase'](),_0x2fc59f={'sticker-pack-id':_0x40548d[_0x130d47(0x13b)]?_0x40548d[_0x130d47(0x13b)]:''+_0x2747c4,'sticker-pack-name':_0x15ade0?_0x15ade0:undefined,'sticker-pack-publisher':_0x1a5745?_0x1a5745:undefined,'android-app-store-link':_0x40548d['androidAppStoreLink']?_0x40548d[_0x130d47(0x113)]:undefined,'ios-app-store-link':_0x40548d[_0x130d47(0x143)]?_0x40548d[_0x130d47(0x143)]:undefined,'is-ai-sticker':_0x40548d[_0x130d47(0x13e)]?0x1:undefined,'is-first-party-sticker':_0x40548d[_0x130d47(0x132)]?0x1:undefined,'accessibility-text':_0x40548d[_0x130d47(0x149)]?_0x40548d[_0x130d47(0x149)]:undefined,'avatar-sticker-template-id':_0x40548d['templateId']?_0x40548d['templateId']:undefined,'is-avatar-sticker':_0x40548d[_0x130d47(0x12e)]?0x1:undefined,'sticker-maker-source-type':_0x40548d[_0x130d47(0x133)]?_0x40548d['stickerMakerSourceType']:undefined,'emojis':_0x4155d9?_0x4155d9:undefined},_0x5b4f3e=Buffer['from']([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x4a66f0=Buffer[_0x130d47(0x12d)](JSON[_0x130d47(0x139)](_0x2fc59f),_0x130d47(0x114)),_0x1cc33f=Buffer[_0x130d47(0x14f)]([_0x5b4f3e,_0x4a66f0]);return _0x1cc33f[_0x130d47(0x130)](_0x4a66f0[_0x130d47(0x155)],0xe,0x4),await _0x26c7c1[_0x130d47(0x15f)](_0xa7bead),_0x26c7c1[_0x130d47(0x134)]=_0x1cc33f,await _0x26c7c1['save'](null);}async function sticker(_0x45f503,_0x11e0d1,..._0x1d3b26){const _0xc3b4b2=a0_0x5a6558;let _0x299b0d,_0x42fce8;for(const _0x1e1dcc of[sticker3,global['support']['ffmpeg']&&sticker6,sticker5,global[_0xc3b4b2(0x119)][_0xc3b4b2(0x15d)]&&global[_0xc3b4b2(0x119)][_0xc3b4b2(0x13f)]&&sticker4,global['support'][_0xc3b4b2(0x15d)]&&(global['support'][_0xc3b4b2(0x13c)]||global[_0xc3b4b2(0x119)][_0xc3b4b2(0x145)]||global['support']['gm'])&&sticker2][_0xc3b4b2(0x142)](_0x293273=>_0x293273)){try{_0x42fce8=await _0x1e1dcc(_0x45f503,_0x11e0d1,..._0x1d3b26);if(_0x42fce8[_0xc3b4b2(0x14a)](_0xc3b4b2(0x150)))continue;if(_0x42fce8[_0xc3b4b2(0x14a)](_0xc3b4b2(0x123)))try{return await addExif(_0x42fce8,..._0x1d3b26);}catch(_0x4c5115){return console[_0xc3b4b2(0x15a)](_0x4c5115),_0x42fce8;}throw _0x42fce8[_0xc3b4b2(0x11d)]();}catch(_0x2e3f59){_0x299b0d=_0x2e3f59;continue;}}return console['error'](_0x299b0d),_0x299b0d;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};