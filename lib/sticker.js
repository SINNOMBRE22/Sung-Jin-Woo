const a0_0x562099=a0_0x12c8;(function(_0x1990b9,_0x19961b){const _0x4c7b28=a0_0x12c8,_0x90073b=_0x1990b9();while(!![]){try{const _0x4f50ae=-parseInt(_0x4c7b28(0x13b))/0x1*(-parseInt(_0x4c7b28(0x182))/0x2)+-parseInt(_0x4c7b28(0x184))/0x3*(-parseInt(_0x4c7b28(0x15b))/0x4)+parseInt(_0x4c7b28(0x17d))/0x5+-parseInt(_0x4c7b28(0x158))/0x6*(parseInt(_0x4c7b28(0x159))/0x7)+-parseInt(_0x4c7b28(0x17f))/0x8+parseInt(_0x4c7b28(0x149))/0x9+-parseInt(_0x4c7b28(0x17e))/0xa*(parseInt(_0x4c7b28(0x17b))/0xb);if(_0x4f50ae===_0x19961b)break;else _0x90073b['push'](_0x90073b['shift']());}catch(_0x2fecb5){_0x90073b['push'](_0x90073b['shift']());}}}(a0_0x2a86,0xd268d));import{dirname}from'path';import{fileURLToPath}from'url';import*as a0_0x13cae0 from'fs';import*as a0_0x421c92 from'path';import*as a0_0x55d217 from'crypto';import{ffmpeg}from'./converter.js';import a0_0x356817 from'fluent-ffmpeg';import{spawn}from'child_process';import a0_0x580c05 from'./uploadFile.js';import a0_0x263f39 from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import a0_0x7eb9f2 from'node-webpmux';function a0_0x12c8(_0x28e2c8,_0x29ee52){const _0x2a86db=a0_0x2a86();return a0_0x12c8=function(_0x12c8bf,_0x37b4ac){_0x12c8bf=_0x12c8bf-0x136;let _0x4a5712=_0x2a86db[_0x12c8bf];return _0x4a5712;},a0_0x12c8(_0x28e2c8,_0x29ee52);}import a0_0x263fcb from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta[a0_0x562099(0x140)])),tmp=a0_0x421c92['join'](__dirname,a0_0x562099(0x179));function sticker2(_0x26c37e,_0x11397f){return new Promise(async(_0x521e70,_0x518852)=>{const _0x3e3e2d=a0_0x12c8;try{if(_0x11397f){const _0x4379a1=await a0_0x263fcb(_0x11397f);if(_0x4379a1[_0x3e3e2d(0x146)]!==0xc8)throw await _0x4379a1[_0x3e3e2d(0x174)]();_0x26c37e=await _0x4379a1[_0x3e3e2d(0x156)]();}const _0x4fe6d4=a0_0x421c92['join'](tmp,+new Date()+_0x3e3e2d(0x186));await a0_0x13cae0[_0x3e3e2d(0x13e)][_0x3e3e2d(0x139)](_0x4fe6d4,_0x26c37e);const _0x2b3d59=spawn(_0x3e3e2d(0x166),['-y','-i',_0x4fe6d4,'-vf',_0x3e3e2d(0x165),'-f',_0x3e3e2d(0x189),'-']);_0x2b3d59['on'](_0x3e3e2d(0x164),_0x518852),_0x2b3d59['on']('close',async()=>{const _0x26cad7=_0x3e3e2d;await a0_0x13cae0[_0x26cad7(0x13e)][_0x26cad7(0x14d)](_0x4fe6d4);});const _0x2d799e=[],[_0x319fd0,..._0x2eb8b5]=[...module[_0x3e3e2d(0x177)][_0x3e3e2d(0x15e)]['gm']?['gm']:module[_0x3e3e2d(0x177)][_0x3e3e2d(0x150)]?[_0x3e3e2d(0x150)]:[],'convert',_0x3e3e2d(0x14b),'webp:-'],_0x526e94=spawn(_0x319fd0,_0x2eb8b5);_0x526e94['on'](_0x3e3e2d(0x164),_0xd92235=>conn[_0x3e3e2d(0x13f)](m['chat'],util[_0x3e3e2d(0x15f)](_0xd92235),m)),_0x526e94[_0x3e3e2d(0x153)]['on'](_0x3e3e2d(0x16f),_0xebea5f=>_0x2d799e[_0x3e3e2d(0x180)](_0xebea5f)),_0x2b3d59[_0x3e3e2d(0x153)][_0x3e3e2d(0x16a)](_0x526e94[_0x3e3e2d(0x168)]),_0x526e94['on'](_0x3e3e2d(0x162),()=>{const _0xf3dfc1=_0x3e3e2d;_0x521e70(Buffer[_0xf3dfc1(0x144)](_0x2d799e));});}catch(_0x17fb22){_0x518852(_0x17fb22);}});}async function sticker3(_0x4ecc01,_0x18d31f,_0x18f42e,_0x34bebd){const _0x579cde=a0_0x562099;_0x18d31f=_0x18d31f?_0x18d31f:await a0_0x580c05(_0x4ecc01);const _0x40b75f=await a0_0x263fcb(_0x579cde(0x14f)+new URLSearchParams(Object[_0x579cde(0x178)]({'url':_0x18d31f,'packname':_0x18f42e,'author':_0x34bebd})));return await _0x40b75f[_0x579cde(0x156)]();}async function sticker4(_0x49888b,_0x3dcd39){const _0x3b91e2=a0_0x562099;if(_0x3dcd39){const _0x1c8649=await a0_0x263fcb(_0x3dcd39);if(_0x1c8649[_0x3b91e2(0x146)]!==0xc8)throw await _0x1c8649[_0x3b91e2(0x174)]();_0x49888b=await _0x1c8649['buffer']();}return await ffmpeg(_0x49888b,[_0x3b91e2(0x143),'scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1'],_0x3b91e2(0x175),_0x3b91e2(0x163));}async function sticker5(_0x2e486f,_0x29d5e1,_0x768f1b,_0x3831ad,_0x307668=[''],_0x2eaf13={}){const _0xb19dc4=a0_0x562099,{Sticker:_0xf5739e}=await import(_0xb19dc4(0x137)),_0x3d2112={'type':'default','pack':_0x768f1b,'author':_0x3831ad,'categories':_0x307668,..._0x2eaf13};return new _0xf5739e(_0x2e486f?_0x2e486f:_0x29d5e1,_0x3d2112)[_0xb19dc4(0x16d)]();}function sticker6(_0x369b60,_0x41f1ce){return new Promise(async(_0x2f4d18,_0x496fc4)=>{const _0x4f29cc=a0_0x12c8;if(_0x41f1ce){const _0x3b70a8=await a0_0x263fcb(_0x41f1ce);if(_0x3b70a8[_0x4f29cc(0x146)]!==0xc8)throw await _0x3b70a8[_0x4f29cc(0x174)]();_0x369b60=await _0x3b70a8[_0x4f29cc(0x156)]();}const _0x360ef1=await fileTypeFromBuffer(_0x369b60)||{'mime':_0x4f29cc(0x16e),'ext':_0x4f29cc(0x155)};if(_0x360ef1[_0x4f29cc(0x16b)]==_0x4f29cc(0x155))_0x496fc4(_0x369b60);const _0x35c6c3=a0_0x421c92[_0x4f29cc(0x15d)](__dirname,'../tmp/'+ +new Date()+'.'+_0x360ef1[_0x4f29cc(0x16b)]),_0x3bb2d8=a0_0x421c92[_0x4f29cc(0x15d)](_0x35c6c3+_0x4f29cc(0x14c));await a0_0x13cae0[_0x4f29cc(0x13e)]['writeFile'](_0x35c6c3,_0x369b60);const _0x3bda2d=/video/i[_0x4f29cc(0x154)](_0x360ef1[_0x4f29cc(0x14e)])?a0_0x356817(_0x35c6c3)['inputFormat'](_0x360ef1[_0x4f29cc(0x16b)]):a0_0x356817(_0x35c6c3)[_0x4f29cc(0x161)](_0x35c6c3);_0x3bda2d['on'](_0x4f29cc(0x164),function(_0x40491d){const _0x2a3019=_0x4f29cc;console[_0x2a3019(0x164)](_0x40491d),a0_0x13cae0['promises'][_0x2a3019(0x14d)](_0x35c6c3),_0x496fc4(_0x369b60);})['on']('end',async function(){const _0x409909=_0x4f29cc;a0_0x13cae0['promises']['unlink'](_0x35c6c3),_0x2f4d18(await a0_0x13cae0[_0x409909(0x13e)][_0x409909(0x185)](_0x3bb2d8));})[_0x4f29cc(0x169)](['-vcodec',_0x4f29cc(0x187),_0x4f29cc(0x143),'scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse'])[_0x4f29cc(0x13a)](_0x4f29cc(0x163))[_0x4f29cc(0x15a)](_0x3bb2d8);});}async function addExif(_0xe9f018,_0x3d191d,_0x3fae48,_0x4b794d=[''],_0x21453c){const _0xa6a430=a0_0x562099,_0xe6342f=new a0_0x7eb9f2[(_0xa6a430(0x141))](),_0xaa0f71=_0xa6a430(0x181)+a0_0x55d217[_0xa6a430(0x151)](0xc)['toString'](_0xa6a430(0x183))[_0xa6a430(0x13d)](),_0x421754={'sticker-pack-id':_0x21453c[_0xa6a430(0x136)]?_0x21453c['packId']:''+_0xaa0f71,'sticker-pack-name':_0x3d191d?_0x3d191d:undefined,'sticker-pack-publisher':_0x3fae48?_0x3fae48:undefined,'android-app-store-link':_0x21453c[_0xa6a430(0x17a)]?_0x21453c['androidAppStoreLink']:undefined,'ios-app-store-link':_0x21453c['iosAppStoreLink']?_0x21453c['iosAppStoreLink']:undefined,'is-ai-sticker':_0x21453c[_0xa6a430(0x176)]?0x1:undefined,'is-first-party-sticker':_0x21453c[_0xa6a430(0x148)]?0x1:undefined,'accessibility-text':_0x21453c[_0xa6a430(0x167)]?_0x21453c[_0xa6a430(0x167)]:undefined,'avatar-sticker-template-id':_0x21453c['templateId']?_0x21453c[_0xa6a430(0x171)]:undefined,'is-avatar-sticker':_0x21453c[_0xa6a430(0x188)]?0x1:undefined,'sticker-maker-source-type':_0x21453c[_0xa6a430(0x172)]?_0x21453c['stickerMakerSourceType']:undefined,'emojis':_0x4b794d?_0x4b794d:undefined},_0x520652=Buffer[_0xa6a430(0x152)]([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x24b8c3=Buffer[_0xa6a430(0x152)](JSON[_0xa6a430(0x17c)](_0x421754),_0xa6a430(0x173)),_0x550bee=Buffer['concat']([_0x520652,_0x24b8c3]);return _0x550bee[_0xa6a430(0x13c)](_0x24b8c3[_0xa6a430(0x160)],0xe,0x4),await _0xe6342f[_0xa6a430(0x147)](_0xe9f018),_0xe6342f[_0xa6a430(0x145)]=_0x550bee,await _0xe6342f[_0xa6a430(0x15a)](null);}async function sticker(_0x1dd25f,_0x3a44a1,..._0x46b136){const _0x52a2c1=a0_0x562099;let _0x385e3f,_0x1cd90f;for(const _0x2b7fdb of[sticker3,global[_0x52a2c1(0x15e)][_0x52a2c1(0x166)]&&sticker6,sticker5,global[_0x52a2c1(0x15e)][_0x52a2c1(0x166)]&&global[_0x52a2c1(0x15e)][_0x52a2c1(0x14a)]&&sticker4,global[_0x52a2c1(0x15e)][_0x52a2c1(0x166)]&&(global[_0x52a2c1(0x15e)][_0x52a2c1(0x170)]||global[_0x52a2c1(0x15e)][_0x52a2c1(0x150)]||global[_0x52a2c1(0x15e)]['gm'])&&sticker2][_0x52a2c1(0x16c)](_0x295169=>_0x295169)){try{_0x1cd90f=await _0x2b7fdb(_0x1dd25f,_0x3a44a1,..._0x46b136);if(_0x1cd90f[_0x52a2c1(0x142)](_0x52a2c1(0x15c)))continue;if(_0x1cd90f[_0x52a2c1(0x142)](_0x52a2c1(0x157)))try{return await addExif(_0x1cd90f,..._0x46b136);}catch(_0x27efb0){return console['error'](_0x27efb0),_0x1cd90f;}throw _0x1cd90f[_0x52a2c1(0x138)]();}catch(_0x17ee86){_0x385e3f=_0x17ee86;continue;}}return console[_0x52a2c1(0x164)](_0x385e3f),_0x385e3f;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};function a0_0x2a86(){const _0x5ac169=['save','8aNOcbH','html','join','support','format','length','input','exit','webp','error','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','ffmpeg','accessibilityText','stdin','addOutputOptions','pipe','ext','filter','toBuffer','application/octet-stream','data','convert','templateId','stickerMakerSourceType','utf8','text','jpeg','isAiSticker','exports','entries','../tmp','androidAppStoreLink','21560132jVemyc','stringify','1206670uFqPbf','10BGSTvd','1435488eJlJJn','push','MYSTIC','2271826WKkAXi','hex','1785603JmlCRi','readFile','.jpeg','libwebp','isAvatarSticker','png','packId','wa-sticker-formatter','toString','writeFile','toFormat','1mLYTuR','writeUIntLE','toUpperCase','promises','reply','url','Image','includes','-vf','concat','exif','status','load','isFirstPartySticker','14525955kbWasr','ffmpegWebp','png:-','.webp','unlink','mime','https://api.xteam.xyz/sticker/wm?','magick','randomBytes','from','stdout','test','bin','buffer','WEBP','7082154PFyKMf','7gpidNf'];a0_0x2a86=function(){return _0x5ac169;};return a0_0x2a86();}