const a0_0x417236=a0_0x3176;function a0_0x421a(){const _0x2db2c5=['writeUIntLE','exif','2RygQvT','8oPfIxz','wa-sticker-formatter','html','from','promises','support','2606988GCTRTn','addOutputOptions','9985WnvbCD','1190277lzpEgk','format','unlink','test','close','androidAppStoreLink','inputFormat','buffer','packId','pipe','exports','isAvatarSticker','end','../tmp','input','exit','bin','convert','writeFile','stringify','png:-','stickerMakerSourceType','https://api.xteam.xyz/sticker/wm?','isFirstPartySticker','push','magick','filter','stdout','webp:-','402521CzNYbT','2587991UjzJfs','reply','load','4432XEdlts','accessibilityText','mime','webp','../tmp/','randomBytes','readFile','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','isAiSticker','iosAppStoreLink','-vcodec','concat','application/octet-stream','Image','1026150WMnNEt','libwebp','length','error','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse','.webp','27nlbMRu','toString','jpeg','templateId','1068aCpgPJ','text','status','ffmpegWebp','hex','default','includes','save','toFormat','utf8','toBuffer','data','WEBP','entries','ffmpeg','-vf','.jpeg','stdin','join','1440DBmnaY'];a0_0x421a=function(){return _0x2db2c5;};return a0_0x421a();}(function(_0x5c8c17,_0x42106b){const _0x2bfa06=a0_0x3176,_0x2ea3ee=_0x5c8c17();while(!![]){try{const _0x44cea8=parseInt(_0x2bfa06(0x202))/0x1*(parseInt(_0x2bfa06(0x1db))/0x2)+-parseInt(_0x2bfa06(0x1c5))/0x3*(-parseInt(_0x2bfa06(0x206))/0x4)+parseInt(_0x2bfa06(0x1e4))/0x5*(parseInt(_0x2bfa06(0x1d8))/0x6)+-parseInt(_0x2bfa06(0x203))/0x7*(parseInt(_0x2bfa06(0x1dc))/0x8)+parseInt(_0x2bfa06(0x21a))/0x9*(-parseInt(_0x2bfa06(0x214))/0xa)+-parseInt(_0x2bfa06(0x1e5))/0xb+-parseInt(_0x2bfa06(0x1e2))/0xc;if(_0x44cea8===_0x42106b)break;else _0x2ea3ee['push'](_0x2ea3ee['shift']());}catch(_0x3b8fbb){_0x2ea3ee['push'](_0x2ea3ee['shift']());}}}(a0_0x421a,0x42b53));import{dirname}from'path';import{fileURLToPath}from'url';import*as a0_0x47822e from'fs';import*as a0_0x3055f7 from'path';import*as a0_0x5df636 from'crypto';import{ffmpeg}from'./converter.js';function a0_0x3176(_0x13c8e4,_0x548abe){const _0x421a13=a0_0x421a();return a0_0x3176=function(_0x3176d7,_0x473992){_0x3176d7=_0x3176d7-0x1c3;let _0x50e684=_0x421a13[_0x3176d7];return _0x50e684;},a0_0x3176(_0x13c8e4,_0x548abe);}import a0_0x2b7d06 from'fluent-ffmpeg';import{spawn}from'child_process';import a0_0x475b9a from'./uploadFile.js';import a0_0x3c735d from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import a0_0x24ba04 from'node-webpmux';import a0_0x2fcf8c from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta['url'])),tmp=a0_0x3055f7[a0_0x417236(0x1d7)](__dirname,a0_0x417236(0x1f2));function sticker2(_0x335907,_0x233d3f){return new Promise(async(_0x2d2b4,_0x123abe)=>{const _0x215a02=a0_0x3176;try{if(_0x233d3f){const _0x2e08ad=await a0_0x2fcf8c(_0x233d3f);if(_0x2e08ad[_0x215a02(0x1c7)]!==0xc8)throw await _0x2e08ad[_0x215a02(0x1c6)]();_0x335907=await _0x2e08ad[_0x215a02(0x1ec)]();}const _0x1b4fc1=a0_0x3055f7[_0x215a02(0x1d7)](tmp,+new Date()+_0x215a02(0x1d5));await a0_0x47822e[_0x215a02(0x1e0)]['writeFile'](_0x1b4fc1,_0x335907);const _0xcf95e8=spawn(_0x215a02(0x1d3),['-y','-i',_0x1b4fc1,'-vf',_0x215a02(0x20d),'-f','png','-']);_0xcf95e8['on']('error',_0x123abe),_0xcf95e8['on'](_0x215a02(0x1e9),async()=>{const _0x19fae7=_0x215a02;await a0_0x47822e[_0x19fae7(0x1e0)][_0x19fae7(0x1e7)](_0x1b4fc1);});const _0x17a9cb=[],[_0x55bf8a,..._0x17afc1]=[...module[_0x215a02(0x1ef)][_0x215a02(0x1e1)]['gm']?['gm']:module[_0x215a02(0x1ef)]['magick']?[_0x215a02(0x1fe)]:[],_0x215a02(0x1f6),_0x215a02(0x1f9),_0x215a02(0x201)],_0x332cdf=spawn(_0x55bf8a,_0x17afc1);_0x332cdf['on']('error',_0x45ab21=>conn[_0x215a02(0x204)](m['chat'],util[_0x215a02(0x1e6)](_0x45ab21),m)),_0x332cdf[_0x215a02(0x200)]['on'](_0x215a02(0x1d0),_0x50f813=>_0x17a9cb[_0x215a02(0x1fd)](_0x50f813)),_0xcf95e8['stdout'][_0x215a02(0x1ee)](_0x332cdf[_0x215a02(0x1d6)]),_0x332cdf['on'](_0x215a02(0x1f4),()=>{_0x2d2b4(Buffer['concat'](_0x17a9cb));});}catch(_0x5ae04c){_0x123abe(_0x5ae04c);}});}async function sticker3(_0x23a7ee,_0x4148ca,_0x2c7312,_0x42cf37){const _0x39be4a=a0_0x417236;_0x4148ca=_0x4148ca?_0x4148ca:await a0_0x475b9a(_0x23a7ee);const _0x5b0d0f=await a0_0x2fcf8c(_0x39be4a(0x1fb)+new URLSearchParams(Object[_0x39be4a(0x1d2)]({'url':_0x4148ca,'packname':_0x2c7312,'author':_0x42cf37})));return await _0x5b0d0f[_0x39be4a(0x1ec)]();}async function sticker4(_0x2d5969,_0x14421d){const _0x5b8575=a0_0x417236;if(_0x14421d){const _0x162358=await a0_0x2fcf8c(_0x14421d);if(_0x162358['status']!==0xc8)throw await _0x162358['text']();_0x2d5969=await _0x162358['buffer']();}return await ffmpeg(_0x2d5969,[_0x5b8575(0x1d4),_0x5b8575(0x20d)],_0x5b8575(0x1c3),'webp');}async function sticker5(_0x1a03f4,_0x163cc7,_0x28d9c8,_0xad201d,_0x46eaec=[''],_0x377566={}){const _0x2b9e85=a0_0x417236,{Sticker:_0x4d7827}=await import(_0x2b9e85(0x1dd)),_0x24f035={'type':_0x2b9e85(0x1ca),'pack':_0x28d9c8,'author':_0xad201d,'categories':_0x46eaec,..._0x377566};return new _0x4d7827(_0x1a03f4?_0x1a03f4:_0x163cc7,_0x24f035)[_0x2b9e85(0x1cf)]();}function sticker6(_0xd45fbb,_0x3ea1b5){return new Promise(async(_0x565c78,_0xaa32a3)=>{const _0x4e7761=a0_0x3176;if(_0x3ea1b5){const _0x4a284e=await a0_0x2fcf8c(_0x3ea1b5);if(_0x4a284e[_0x4e7761(0x1c7)]!==0xc8)throw await _0x4a284e[_0x4e7761(0x1c6)]();_0xd45fbb=await _0x4a284e['buffer']();}const _0xc897a2=await fileTypeFromBuffer(_0xd45fbb)||{'mime':_0x4e7761(0x212),'ext':_0x4e7761(0x1f5)};if(_0xc897a2['ext']==_0x4e7761(0x1f5))_0xaa32a3(_0xd45fbb);const _0x22accd=a0_0x3055f7[_0x4e7761(0x1d7)](__dirname,_0x4e7761(0x20a)+ +new Date()+'.'+_0xc897a2['ext']),_0x15353e=a0_0x3055f7[_0x4e7761(0x1d7)](_0x22accd+_0x4e7761(0x219));await a0_0x47822e['promises'][_0x4e7761(0x1f7)](_0x22accd,_0xd45fbb);const _0x2a0955=/video/i[_0x4e7761(0x1e8)](_0xc897a2[_0x4e7761(0x208)])?a0_0x2b7d06(_0x22accd)[_0x4e7761(0x1eb)](_0xc897a2['ext']):a0_0x2b7d06(_0x22accd)[_0x4e7761(0x1f3)](_0x22accd);_0x2a0955['on'](_0x4e7761(0x217),function(_0x1dbe79){const _0x497fab=_0x4e7761;console['error'](_0x1dbe79),a0_0x47822e['promises'][_0x497fab(0x1e7)](_0x22accd),_0xaa32a3(_0xd45fbb);})['on'](_0x4e7761(0x1f1),async function(){const _0x2c614c=_0x4e7761;a0_0x47822e[_0x2c614c(0x1e0)][_0x2c614c(0x1e7)](_0x22accd),_0x565c78(await a0_0x47822e[_0x2c614c(0x1e0)][_0x2c614c(0x20c)](_0x15353e));})[_0x4e7761(0x1e3)]([_0x4e7761(0x210),_0x4e7761(0x215),_0x4e7761(0x1d4),_0x4e7761(0x218)])[_0x4e7761(0x1cd)](_0x4e7761(0x209))['save'](_0x15353e);});}async function addExif(_0x3a23a1,_0x4c47a4,_0x17d655,_0x1fc8ef=[''],_0x3283fd){const _0x1978ad=a0_0x417236,_0x3e9761=new a0_0x24ba04[(_0x1978ad(0x213))](),_0x45dfe2='MYSTIC'+a0_0x5df636[_0x1978ad(0x20b)](0xc)[_0x1978ad(0x21b)](_0x1978ad(0x1c9))['toUpperCase'](),_0x5ecc5d={'sticker-pack-id':_0x3283fd[_0x1978ad(0x1ed)]?_0x3283fd['packId']:''+_0x45dfe2,'sticker-pack-name':_0x4c47a4?_0x4c47a4:undefined,'sticker-pack-publisher':_0x17d655?_0x17d655:undefined,'android-app-store-link':_0x3283fd[_0x1978ad(0x1ea)]?_0x3283fd[_0x1978ad(0x1ea)]:undefined,'ios-app-store-link':_0x3283fd[_0x1978ad(0x20f)]?_0x3283fd['iosAppStoreLink']:undefined,'is-ai-sticker':_0x3283fd[_0x1978ad(0x20e)]?0x1:undefined,'is-first-party-sticker':_0x3283fd[_0x1978ad(0x1fc)]?0x1:undefined,'accessibility-text':_0x3283fd['accessibilityText']?_0x3283fd[_0x1978ad(0x207)]:undefined,'avatar-sticker-template-id':_0x3283fd[_0x1978ad(0x1c4)]?_0x3283fd['templateId']:undefined,'is-avatar-sticker':_0x3283fd[_0x1978ad(0x1f0)]?0x1:undefined,'sticker-maker-source-type':_0x3283fd[_0x1978ad(0x1fa)]?_0x3283fd['stickerMakerSourceType']:undefined,'emojis':_0x1fc8ef?_0x1fc8ef:undefined},_0x1025a8=Buffer[_0x1978ad(0x1df)]([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x55a665=Buffer[_0x1978ad(0x1df)](JSON[_0x1978ad(0x1f8)](_0x5ecc5d),_0x1978ad(0x1ce)),_0xfc6fd7=Buffer[_0x1978ad(0x211)]([_0x1025a8,_0x55a665]);return _0xfc6fd7[_0x1978ad(0x1d9)](_0x55a665[_0x1978ad(0x216)],0xe,0x4),await _0x3e9761[_0x1978ad(0x205)](_0x3a23a1),_0x3e9761[_0x1978ad(0x1da)]=_0xfc6fd7,await _0x3e9761[_0x1978ad(0x1cc)](null);}async function sticker(_0x291079,_0x11e177,..._0x5487d5){const _0x6f4be8=a0_0x417236;let _0x17d441,_0x392ba7;for(const _0x55e969 of[sticker3,global[_0x6f4be8(0x1e1)][_0x6f4be8(0x1d3)]&&sticker6,sticker5,global['support'][_0x6f4be8(0x1d3)]&&global[_0x6f4be8(0x1e1)][_0x6f4be8(0x1c8)]&&sticker4,global['support'][_0x6f4be8(0x1d3)]&&(global[_0x6f4be8(0x1e1)][_0x6f4be8(0x1f6)]||global[_0x6f4be8(0x1e1)][_0x6f4be8(0x1fe)]||global['support']['gm'])&&sticker2][_0x6f4be8(0x1ff)](_0x5dbe8f=>_0x5dbe8f)){try{_0x392ba7=await _0x55e969(_0x291079,_0x11e177,..._0x5487d5);if(_0x392ba7[_0x6f4be8(0x1cb)](_0x6f4be8(0x1de)))continue;if(_0x392ba7['includes'](_0x6f4be8(0x1d1)))try{return await addExif(_0x392ba7,..._0x5487d5);}catch(_0x39de5e){return console[_0x6f4be8(0x217)](_0x39de5e),_0x392ba7;}throw _0x392ba7['toString']();}catch(_0x39c414){_0x17d441=_0x39c414;continue;}}return console[_0x6f4be8(0x217)](_0x17d441),_0x17d441;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};