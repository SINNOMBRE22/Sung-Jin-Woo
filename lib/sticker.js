const a0_0x1edc74=a0_0x5948;(function(_0x5708b5,_0x58ae21){const _0x359c03=a0_0x5948,_0xb83fc5=_0x5708b5();while(!![]){try{const _0x5db489=-parseInt(_0x359c03(0x1f5))/0x1+parseInt(_0x359c03(0x1d4))/0x2*(parseInt(_0x359c03(0x1eb))/0x3)+-parseInt(_0x359c03(0x1c4))/0x4+-parseInt(_0x359c03(0x1ba))/0x5+parseInt(_0x359c03(0x1e0))/0x6+parseInt(_0x359c03(0x1e9))/0x7*(-parseInt(_0x359c03(0x1c2))/0x8)+parseInt(_0x359c03(0x1f7))/0x9*(parseInt(_0x359c03(0x1d6))/0xa);if(_0x5db489===_0x58ae21)break;else _0xb83fc5['push'](_0xb83fc5['shift']());}catch(_0x29c4cd){_0xb83fc5['push'](_0xb83fc5['shift']());}}}(a0_0x47f9,0xd06bd));import{dirname}from'path';import{fileURLToPath}from'url';import*as a0_0x97c120 from'fs';import*as a0_0x41d8e6 from'path';import*as a0_0x51a1c6 from'crypto';import{ffmpeg}from'./converter.js';import a0_0x4fc183 from'fluent-ffmpeg';function a0_0x5948(_0xeadd0,_0x25fa5e){const _0x47f90d=a0_0x47f9();return a0_0x5948=function(_0x594897,_0x2d0e0e){_0x594897=_0x594897-0x1b8;let _0x396389=_0x47f90d[_0x594897];return _0x396389;},a0_0x5948(_0xeadd0,_0x25fa5e);}import{spawn}from'child_process';import a0_0x21384b from'./uploadFile.js';import a0_0x1e272d from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import a0_0x5e6a17 from'node-webpmux';import a0_0x59f78a from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta[a0_0x1edc74(0x1d2)])),tmp=a0_0x41d8e6[a0_0x1edc74(0x1cf)](__dirname,a0_0x1edc74(0x1bb));function sticker2(_0xd6ea57,_0x2c94a2){return new Promise(async(_0x45068e,_0x526d48)=>{const _0x234d94=a0_0x5948;try{if(_0x2c94a2){const _0x58280c=await a0_0x59f78a(_0x2c94a2);if(_0x58280c['status']!==0xc8)throw await _0x58280c[_0x234d94(0x1df)]();_0xd6ea57=await _0x58280c[_0x234d94(0x1e8)]();}const _0xd46c5e=a0_0x41d8e6['join'](tmp,+new Date()+'.jpeg');await a0_0x97c120[_0x234d94(0x1f1)][_0x234d94(0x1dd)](_0xd46c5e,_0xd6ea57);const _0x13de2a=spawn('ffmpeg',['-y','-i',_0xd46c5e,_0x234d94(0x1c6),'scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','-f',_0x234d94(0x1e6),'-']);_0x13de2a['on'](_0x234d94(0x1d0),_0x526d48),_0x13de2a['on'](_0x234d94(0x1cc),async()=>{const _0x1ce072=_0x234d94;await a0_0x97c120[_0x1ce072(0x1f1)]['unlink'](_0xd46c5e);});const _0x432991=[],[_0x26f95e,..._0xf70f35]=[...module['exports'][_0x234d94(0x200)]['gm']?['gm']:module['exports'][_0x234d94(0x1ce)]?[_0x234d94(0x1ce)]:[],_0x234d94(0x1e4),'png:-',_0x234d94(0x1ec)],_0x368216=spawn(_0x26f95e,_0xf70f35);_0x368216['on'](_0x234d94(0x1d0),_0x5196d6=>conn[_0x234d94(0x1bf)](m[_0x234d94(0x1ca)],util[_0x234d94(0x1f4)](_0x5196d6),m)),_0x368216[_0x234d94(0x1ed)]['on'](_0x234d94(0x1ee),_0x525ef3=>_0x432991[_0x234d94(0x1e1)](_0x525ef3)),_0x13de2a[_0x234d94(0x1ed)][_0x234d94(0x1d9)](_0x368216[_0x234d94(0x1f8)]),_0x368216['on']('exit',()=>{const _0x261915=_0x234d94;_0x45068e(Buffer[_0x261915(0x1b8)](_0x432991));});}catch(_0x52da1d){_0x526d48(_0x52da1d);}});}async function sticker3(_0x5ce717,_0x112369,_0x5b4ccf,_0x527ab3){const _0x384ec6=a0_0x1edc74;_0x112369=_0x112369?_0x112369:await a0_0x21384b(_0x5ce717);const _0x21642d=await a0_0x59f78a(_0x384ec6(0x1bd)+new URLSearchParams(Object['entries']({'url':_0x112369,'packname':_0x5b4ccf,'author':_0x527ab3})));return await _0x21642d[_0x384ec6(0x1e8)]();}async function sticker4(_0xaf9ae1,_0x3798ba){const _0x33b97b=a0_0x1edc74;if(_0x3798ba){const _0x2888fb=await a0_0x59f78a(_0x3798ba);if(_0x2888fb[_0x33b97b(0x1fa)]!==0xc8)throw await _0x2888fb[_0x33b97b(0x1df)]();_0xaf9ae1=await _0x2888fb[_0x33b97b(0x1e8)]();}return await ffmpeg(_0xaf9ae1,[_0x33b97b(0x1c6),_0x33b97b(0x1e2)],_0x33b97b(0x1b9),_0x33b97b(0x1ef));}async function sticker5(_0x43ff90,_0x455d39,_0x5b5d36,_0x40cbd1,_0x47284b=[''],_0xae691a={}){const _0x22f983=a0_0x1edc74,{Sticker:_0x52b29e}=await import('wa-sticker-formatter'),_0x447cac={'type':'default','pack':_0x5b5d36,'author':_0x40cbd1,'categories':_0x47284b,..._0xae691a};return new _0x52b29e(_0x43ff90?_0x43ff90:_0x455d39,_0x447cac)[_0x22f983(0x204)]();}function a0_0x47f9(){const _0x88154b=['application/octet-stream','concat','jpeg','7582825WWPXRU','../tmp','filter','https://api.xteam.xyz/sticker/wm?','ffmpegWebp','reply','toUpperCase','-vcodec','88ScLotZ','length','2732232KGQVCz','isAvatarSticker','-vf','.webp','packId','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse','chat','load','close','from','magick','join','error','exif','url','androidAppStoreLink','44hWCXPb','utf8','1877280swwZVJ','randomBytes','stickerMakerSourceType','pipe','toString','input','accessibilityText','writeFile','isAiSticker','text','8765166qtFfIw','push','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','addOutputOptions','convert','Image','png','libwebp','buffer','67431QmioOE','ext','85209FutDEu','webp:-','stdout','data','webp','mime','promises','end','iosAppStoreLink','format','616000fuCsTV','../tmp/','81HFlLnt','stdin','save','status','templateId','bin','MYSTIC','WEBP','html','support','unlink','includes','ffmpeg','toBuffer'];a0_0x47f9=function(){return _0x88154b;};return a0_0x47f9();}function sticker6(_0x26b347,_0x2a5126){return new Promise(async(_0x262932,_0x20c2cf)=>{const _0x133334=a0_0x5948;if(_0x2a5126){const _0xabefce=await a0_0x59f78a(_0x2a5126);if(_0xabefce[_0x133334(0x1fa)]!==0xc8)throw await _0xabefce['text']();_0x26b347=await _0xabefce[_0x133334(0x1e8)]();}const _0x15a06a=await fileTypeFromBuffer(_0x26b347)||{'mime':_0x133334(0x205),'ext':'bin'};if(_0x15a06a[_0x133334(0x1ea)]==_0x133334(0x1fc))_0x20c2cf(_0x26b347);const _0xe8c873=a0_0x41d8e6[_0x133334(0x1cf)](__dirname,_0x133334(0x1f6)+ +new Date()+'.'+_0x15a06a[_0x133334(0x1ea)]),_0x3647dd=a0_0x41d8e6['join'](_0xe8c873+_0x133334(0x1c7));await a0_0x97c120[_0x133334(0x1f1)][_0x133334(0x1dd)](_0xe8c873,_0x26b347);const _0x5604e9=/video/i['test'](_0x15a06a[_0x133334(0x1f0)])?a0_0x4fc183(_0xe8c873)['inputFormat'](_0x15a06a['ext']):a0_0x4fc183(_0xe8c873)[_0x133334(0x1db)](_0xe8c873);_0x5604e9['on'](_0x133334(0x1d0),function(_0x3c0db6){const _0x2a4978=_0x133334;console[_0x2a4978(0x1d0)](_0x3c0db6),a0_0x97c120[_0x2a4978(0x1f1)][_0x2a4978(0x201)](_0xe8c873),_0x20c2cf(_0x26b347);})['on'](_0x133334(0x1f2),async function(){const _0x294423=_0x133334;a0_0x97c120[_0x294423(0x1f1)][_0x294423(0x201)](_0xe8c873),_0x262932(await a0_0x97c120[_0x294423(0x1f1)]['readFile'](_0x3647dd));})[_0x133334(0x1e3)]([_0x133334(0x1c1),_0x133334(0x1e7),'-vf',_0x133334(0x1c9)])['toFormat'](_0x133334(0x1ef))[_0x133334(0x1f9)](_0x3647dd);});}async function addExif(_0x2f5ea7,_0x42b6be,_0x1f9d92,_0x812a10=[''],_0x3d9e1c){const _0x2754f1=a0_0x1edc74,_0x10a2c2=new a0_0x5e6a17[(_0x2754f1(0x1e5))](),_0x2cdb6f=_0x2754f1(0x1fd)+a0_0x51a1c6[_0x2754f1(0x1d7)](0xc)['toString']('hex')[_0x2754f1(0x1c0)](),_0x66dd3e={'sticker-pack-id':_0x3d9e1c['packId']?_0x3d9e1c[_0x2754f1(0x1c8)]:''+_0x2cdb6f,'sticker-pack-name':_0x42b6be?_0x42b6be:undefined,'sticker-pack-publisher':_0x1f9d92?_0x1f9d92:undefined,'android-app-store-link':_0x3d9e1c[_0x2754f1(0x1d3)]?_0x3d9e1c[_0x2754f1(0x1d3)]:undefined,'ios-app-store-link':_0x3d9e1c[_0x2754f1(0x1f3)]?_0x3d9e1c[_0x2754f1(0x1f3)]:undefined,'is-ai-sticker':_0x3d9e1c[_0x2754f1(0x1de)]?0x1:undefined,'is-first-party-sticker':_0x3d9e1c['isFirstPartySticker']?0x1:undefined,'accessibility-text':_0x3d9e1c[_0x2754f1(0x1dc)]?_0x3d9e1c[_0x2754f1(0x1dc)]:undefined,'avatar-sticker-template-id':_0x3d9e1c['templateId']?_0x3d9e1c[_0x2754f1(0x1fb)]:undefined,'is-avatar-sticker':_0x3d9e1c[_0x2754f1(0x1c5)]?0x1:undefined,'sticker-maker-source-type':_0x3d9e1c[_0x2754f1(0x1d8)]?_0x3d9e1c['stickerMakerSourceType']:undefined,'emojis':_0x812a10?_0x812a10:undefined},_0x56f194=Buffer[_0x2754f1(0x1cd)]([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x4039bd=Buffer[_0x2754f1(0x1cd)](JSON['stringify'](_0x66dd3e),_0x2754f1(0x1d5)),_0x19e9c4=Buffer['concat']([_0x56f194,_0x4039bd]);return _0x19e9c4['writeUIntLE'](_0x4039bd[_0x2754f1(0x1c3)],0xe,0x4),await _0x10a2c2[_0x2754f1(0x1cb)](_0x2f5ea7),_0x10a2c2[_0x2754f1(0x1d1)]=_0x19e9c4,await _0x10a2c2['save'](null);}async function sticker(_0x47d0b1,_0x5edea0,..._0x4cc1ae){const _0x157015=a0_0x1edc74;let _0xfbbfbf,_0x4a642d;for(const _0x40d767 of[sticker3,global[_0x157015(0x200)][_0x157015(0x203)]&&sticker6,sticker5,global['support']['ffmpeg']&&global['support'][_0x157015(0x1be)]&&sticker4,global[_0x157015(0x200)][_0x157015(0x203)]&&(global[_0x157015(0x200)][_0x157015(0x1e4)]||global[_0x157015(0x200)][_0x157015(0x1ce)]||global[_0x157015(0x200)]['gm'])&&sticker2][_0x157015(0x1bc)](_0x6e316f=>_0x6e316f)){try{_0x4a642d=await _0x40d767(_0x47d0b1,_0x5edea0,..._0x4cc1ae);if(_0x4a642d[_0x157015(0x202)](_0x157015(0x1ff)))continue;if(_0x4a642d[_0x157015(0x202)](_0x157015(0x1fe)))try{return await addExif(_0x4a642d,..._0x4cc1ae);}catch(_0x96cf21){return console[_0x157015(0x1d0)](_0x96cf21),_0x4a642d;}throw _0x4a642d[_0x157015(0x1da)]();}catch(_0x548cc8){_0xfbbfbf=_0x548cc8;continue;}}return console[_0x157015(0x1d0)](_0xfbbfbf),_0xfbbfbf;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};