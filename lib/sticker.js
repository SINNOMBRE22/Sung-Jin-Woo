const a0_0x56c25c=a0_0x4a87;(function(_0x38fe5c,_0x9170e2){const _0x5c6340=a0_0x4a87,_0x50d511=_0x38fe5c();while(!![]){try{const _0x151057=parseInt(_0x5c6340(0x164))/0x1*(-parseInt(_0x5c6340(0x143))/0x2)+parseInt(_0x5c6340(0x182))/0x3+parseInt(_0x5c6340(0x154))/0x4+-parseInt(_0x5c6340(0x14c))/0x5*(parseInt(_0x5c6340(0x183))/0x6)+parseInt(_0x5c6340(0x15e))/0x7+parseInt(_0x5c6340(0x15d))/0x8*(parseInt(_0x5c6340(0x17a))/0x9)+-parseInt(_0x5c6340(0x14b))/0xa*(parseInt(_0x5c6340(0x17c))/0xb);if(_0x151057===_0x9170e2)break;else _0x50d511['push'](_0x50d511['shift']());}catch(_0x234489){_0x50d511['push'](_0x50d511['shift']());}}}(a0_0x3ffd,0xcf1eb));import{dirname}from'path';import{fileURLToPath}from'url';import*as a0_0x3ec0d2 from'fs';function a0_0x4a87(_0x44b81c,_0x23c589){const _0x3ffd6c=a0_0x3ffd();return a0_0x4a87=function(_0x4a87d4,_0x1c0b23){_0x4a87d4=_0x4a87d4-0x141;let _0xb8df89=_0x3ffd6c[_0x4a87d4];return _0xb8df89;},a0_0x4a87(_0x44b81c,_0x23c589);}import*as a0_0x5bc446 from'path';import*as a0_0x1eb928 from'crypto';import{ffmpeg}from'./converter.js';import a0_0x20f4e6 from'fluent-ffmpeg';function a0_0x3ffd(){const _0x328b55=['../tmp/','.webp','837hktNoU','toUpperCase','11xIbpAy','isAvatarSticker','exports','convert','readFile','jpeg','1047873bKKDva','6FkLObo','default','includes','WEBP','input','hex','addOutputOptions','join','inputFormat','isFirstPartySticker','Image','error','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse','templateId','writeUIntLE','https://api.xteam.xyz/sticker/wm?','toString','save','271028hprBcg','pipe','buffer','test','libwebp','exit','load','-vcodec','20340170ctlnER','2959615qKYPir','ffmpegWebp','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','chat','push','packId','promises','status','5612096tvuhjJ','ext','format','end','support','close','ffmpeg','toFormat','stdin','27928zdSdwh','11678471afDBer','wa-sticker-formatter','randomBytes','reply','writeFile','stdout','2PtvZKd','magick','text','from','androidAppStoreLink','unlink','url','concat','accessibilityText','webp','../tmp','data','-vf','.jpeg','entries','exif','png','toBuffer','MYSTIC','iosAppStoreLink'];a0_0x3ffd=function(){return _0x328b55;};return a0_0x3ffd();}import{spawn}from'child_process';import a0_0x2ed159 from'./uploadFile.js';import a0_0x5f2148 from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import a0_0x3a0b86 from'node-webpmux';import a0_0x410e70 from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta[a0_0x56c25c(0x16a)])),tmp=a0_0x5bc446[a0_0x56c25c(0x18a)](__dirname,a0_0x56c25c(0x16e));function sticker2(_0x4d23d6,_0x48355b){return new Promise(async(_0x503cd3,_0x4e6fc8)=>{const _0x4e09bb=a0_0x4a87;try{if(_0x48355b){const _0x25d005=await a0_0x410e70(_0x48355b);if(_0x25d005['status']!==0xc8)throw await _0x25d005[_0x4e09bb(0x166)]();_0x4d23d6=await _0x25d005[_0x4e09bb(0x145)]();}const _0x41ee50=a0_0x5bc446['join'](tmp,+new Date()+_0x4e09bb(0x171));await a0_0x3ec0d2[_0x4e09bb(0x152)]['writeFile'](_0x41ee50,_0x4d23d6);const _0x2b9462=spawn(_0x4e09bb(0x15a),['-y','-i',_0x41ee50,_0x4e09bb(0x170),_0x4e09bb(0x14e),'-f',_0x4e09bb(0x174),'-']);_0x2b9462['on'](_0x4e09bb(0x18e),_0x4e6fc8),_0x2b9462['on'](_0x4e09bb(0x159),async()=>{const _0x5245b2=_0x4e09bb;await a0_0x3ec0d2[_0x5245b2(0x152)][_0x5245b2(0x169)](_0x41ee50);});const _0x311bcf=[],[_0x1fba63,..._0x492fc4]=[...module[_0x4e09bb(0x17e)]['support']['gm']?['gm']:module[_0x4e09bb(0x17e)][_0x4e09bb(0x165)]?[_0x4e09bb(0x165)]:[],_0x4e09bb(0x17f),'png:-','webp:-'],_0x50bbe9=spawn(_0x1fba63,_0x492fc4);_0x50bbe9['on']('error',_0x3df1df=>conn[_0x4e09bb(0x161)](m[_0x4e09bb(0x14f)],util[_0x4e09bb(0x156)](_0x3df1df),m)),_0x50bbe9['stdout']['on'](_0x4e09bb(0x16f),_0x47116b=>_0x311bcf[_0x4e09bb(0x150)](_0x47116b)),_0x2b9462[_0x4e09bb(0x163)][_0x4e09bb(0x144)](_0x50bbe9[_0x4e09bb(0x15c)]),_0x50bbe9['on'](_0x4e09bb(0x148),()=>{const _0x3b6b88=_0x4e09bb;_0x503cd3(Buffer[_0x3b6b88(0x16b)](_0x311bcf));});}catch(_0x4aa6d2){_0x4e6fc8(_0x4aa6d2);}});}async function sticker3(_0x458416,_0x1eb6fa,_0x337768,_0x5444a7){const _0x5d6afd=a0_0x56c25c;_0x1eb6fa=_0x1eb6fa?_0x1eb6fa:await a0_0x2ed159(_0x458416);const _0x4a543b=await a0_0x410e70(_0x5d6afd(0x192)+new URLSearchParams(Object[_0x5d6afd(0x172)]({'url':_0x1eb6fa,'packname':_0x337768,'author':_0x5444a7})));return await _0x4a543b[_0x5d6afd(0x145)]();}async function sticker4(_0x59638f,_0x687a22){const _0x54d44c=a0_0x56c25c;if(_0x687a22){const _0x5c9aa1=await a0_0x410e70(_0x687a22);if(_0x5c9aa1[_0x54d44c(0x153)]!==0xc8)throw await _0x5c9aa1[_0x54d44c(0x166)]();_0x59638f=await _0x5c9aa1[_0x54d44c(0x145)]();}return await ffmpeg(_0x59638f,['-vf',_0x54d44c(0x14e)],_0x54d44c(0x181),_0x54d44c(0x16d));}async function sticker5(_0x598c4b,_0x57013d,_0x1a1678,_0x651fa6,_0x247651=[''],_0x4617ec={}){const _0x118e95=a0_0x56c25c,{Sticker:_0x548bdc}=await import(_0x118e95(0x15f)),_0x20fec4={'type':_0x118e95(0x184),'pack':_0x1a1678,'author':_0x651fa6,'categories':_0x247651,..._0x4617ec};return new _0x548bdc(_0x598c4b?_0x598c4b:_0x57013d,_0x20fec4)[_0x118e95(0x175)]();}function sticker6(_0x4d0a50,_0x28891b){return new Promise(async(_0x7061e0,_0x26551e)=>{const _0x5377bd=a0_0x4a87;if(_0x28891b){const _0x2d7bbe=await a0_0x410e70(_0x28891b);if(_0x2d7bbe[_0x5377bd(0x153)]!==0xc8)throw await _0x2d7bbe[_0x5377bd(0x166)]();_0x4d0a50=await _0x2d7bbe[_0x5377bd(0x145)]();}const _0x5c8c23=await fileTypeFromBuffer(_0x4d0a50)||{'mime':'application/octet-stream','ext':'bin'};if(_0x5c8c23['ext']=='bin')_0x26551e(_0x4d0a50);const _0x7537ea=a0_0x5bc446[_0x5377bd(0x18a)](__dirname,_0x5377bd(0x178)+ +new Date()+'.'+_0x5c8c23[_0x5377bd(0x155)]),_0x43e9e5=a0_0x5bc446['join'](_0x7537ea+_0x5377bd(0x179));await a0_0x3ec0d2[_0x5377bd(0x152)][_0x5377bd(0x162)](_0x7537ea,_0x4d0a50);const _0x1b0d57=/video/i[_0x5377bd(0x146)](_0x5c8c23['mime'])?a0_0x20f4e6(_0x7537ea)[_0x5377bd(0x18b)](_0x5c8c23[_0x5377bd(0x155)]):a0_0x20f4e6(_0x7537ea)[_0x5377bd(0x187)](_0x7537ea);_0x1b0d57['on'](_0x5377bd(0x18e),function(_0x5d8fe2){const _0x578cb5=_0x5377bd;console[_0x578cb5(0x18e)](_0x5d8fe2),a0_0x3ec0d2[_0x578cb5(0x152)][_0x578cb5(0x169)](_0x7537ea),_0x26551e(_0x4d0a50);})['on'](_0x5377bd(0x157),async function(){const _0x451a10=_0x5377bd;a0_0x3ec0d2[_0x451a10(0x152)][_0x451a10(0x169)](_0x7537ea),_0x7061e0(await a0_0x3ec0d2[_0x451a10(0x152)][_0x451a10(0x180)](_0x43e9e5));})[_0x5377bd(0x189)]([_0x5377bd(0x14a),_0x5377bd(0x147),_0x5377bd(0x170),_0x5377bd(0x18f)])[_0x5377bd(0x15b)](_0x5377bd(0x16d))[_0x5377bd(0x142)](_0x43e9e5);});}async function addExif(_0x320c5e,_0x51d549,_0x1e2aec,_0x34b270=[''],_0x27fed9){const _0xb894f=a0_0x56c25c,_0x2165d0=new a0_0x3a0b86[(_0xb894f(0x18d))](),_0x2a0f2d=_0xb894f(0x176)+a0_0x1eb928[_0xb894f(0x160)](0xc)[_0xb894f(0x141)](_0xb894f(0x188))[_0xb894f(0x17b)](),_0x2ef3a1={'sticker-pack-id':_0x27fed9[_0xb894f(0x151)]?_0x27fed9[_0xb894f(0x151)]:''+_0x2a0f2d,'sticker-pack-name':_0x51d549?_0x51d549:undefined,'sticker-pack-publisher':_0x1e2aec?_0x1e2aec:undefined,'android-app-store-link':_0x27fed9[_0xb894f(0x168)]?_0x27fed9['androidAppStoreLink']:undefined,'ios-app-store-link':_0x27fed9[_0xb894f(0x177)]?_0x27fed9['iosAppStoreLink']:undefined,'is-ai-sticker':_0x27fed9['isAiSticker']?0x1:undefined,'is-first-party-sticker':_0x27fed9[_0xb894f(0x18c)]?0x1:undefined,'accessibility-text':_0x27fed9[_0xb894f(0x16c)]?_0x27fed9[_0xb894f(0x16c)]:undefined,'avatar-sticker-template-id':_0x27fed9[_0xb894f(0x190)]?_0x27fed9[_0xb894f(0x190)]:undefined,'is-avatar-sticker':_0x27fed9[_0xb894f(0x17d)]?0x1:undefined,'sticker-maker-source-type':_0x27fed9['stickerMakerSourceType']?_0x27fed9['stickerMakerSourceType']:undefined,'emojis':_0x34b270?_0x34b270:undefined},_0x180654=Buffer[_0xb894f(0x167)]([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x59766d=Buffer[_0xb894f(0x167)](JSON['stringify'](_0x2ef3a1),'utf8'),_0x129ac8=Buffer['concat']([_0x180654,_0x59766d]);return _0x129ac8[_0xb894f(0x191)](_0x59766d['length'],0xe,0x4),await _0x2165d0[_0xb894f(0x149)](_0x320c5e),_0x2165d0[_0xb894f(0x173)]=_0x129ac8,await _0x2165d0['save'](null);}async function sticker(_0x276ef7,_0x59a30e,..._0x95f0c9){const _0x29afed=a0_0x56c25c;let _0x1d16cb,_0x128ebe;for(const _0x3665dc of[sticker3,global[_0x29afed(0x158)][_0x29afed(0x15a)]&&sticker6,sticker5,global[_0x29afed(0x158)][_0x29afed(0x15a)]&&global[_0x29afed(0x158)][_0x29afed(0x14d)]&&sticker4,global[_0x29afed(0x158)][_0x29afed(0x15a)]&&(global[_0x29afed(0x158)]['convert']||global[_0x29afed(0x158)][_0x29afed(0x165)]||global[_0x29afed(0x158)]['gm'])&&sticker2]['filter'](_0x40309d=>_0x40309d)){try{_0x128ebe=await _0x3665dc(_0x276ef7,_0x59a30e,..._0x95f0c9);if(_0x128ebe['includes']('html'))continue;if(_0x128ebe[_0x29afed(0x185)](_0x29afed(0x186)))try{return await addExif(_0x128ebe,..._0x95f0c9);}catch(_0x393cfc){return console[_0x29afed(0x18e)](_0x393cfc),_0x128ebe;}throw _0x128ebe[_0x29afed(0x141)]();}catch(_0x4dfca4){_0x1d16cb=_0x4dfca4;continue;}}return console['error'](_0x1d16cb),_0x1d16cb;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};