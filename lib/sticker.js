const a0_0x3ef826=a0_0x31b7;(function(_0x19ae69,_0x2feff5){const _0x19cb1c=a0_0x31b7,_0x546112=_0x19ae69();while(!![]){try{const _0x2a5307=parseInt(_0x19cb1c(0x200))/0x1*(parseInt(_0x19cb1c(0x1f5))/0x2)+parseInt(_0x19cb1c(0x1eb))/0x3*(-parseInt(_0x19cb1c(0x21c))/0x4)+-parseInt(_0x19cb1c(0x201))/0x5+parseInt(_0x19cb1c(0x1e0))/0x6+-parseInt(_0x19cb1c(0x209))/0x7+-parseInt(_0x19cb1c(0x1f7))/0x8*(-parseInt(_0x19cb1c(0x1dc))/0x9)+-parseInt(_0x19cb1c(0x1e9))/0xa*(-parseInt(_0x19cb1c(0x204))/0xb);if(_0x2a5307===_0x2feff5)break;else _0x546112['push'](_0x546112['shift']());}catch(_0x11a4aa){_0x546112['push'](_0x546112['shift']());}}}(a0_0x401a,0x6541e));import{dirname}from'path';function a0_0x401a(){const _0x64c3a8=['2243045InKUaD','exports','pipe','chat','toFormat','https://api.xteam.xyz/sticker/wm?','-vf','reply','load','androidAppStoreLink','inputFormat','Image','application/octet-stream','ext','magick','status','data','templateId','wa-sticker-formatter','24dUPxZq','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1','stdout','../tmp/','length','html','../tmp','push','convert','url','includes','.jpeg','save','randomBytes','buffer','5073813zHDngV','stickerMakerSourceType','isAiSticker','bin','4198980MbNszF','addOutputOptions','packId','toString','webp:-','jpeg','join','text','png','811150hqnTAu','mime','139500qkvkUq','hex','exif','error','default','iosAppStoreLink','libwebp','unlink','exit','concat','16BByZuB','accessibilityText','8DpQkPG','stringify','webp','ffmpegWebp','.webp','ffmpeg','promises','support','writeFile','5573ZZlYCj','1875505OjpBdR','isFirstPartySticker','end','11RqefiE','toUpperCase','format','writeUIntLE','entries'];a0_0x401a=function(){return _0x64c3a8;};return a0_0x401a();}import{fileURLToPath}from'url';import*as a0_0x49b4bb from'fs';import*as a0_0x17941c from'path';import*as a0_0xff33a6 from'crypto';import{ffmpeg}from'./converter.js';import a0_0x1f5747 from'fluent-ffmpeg';import{spawn}from'child_process';import a0_0x369ab2 from'./uploadFile.js';import a0_0xa30cdd from'./uploadImage.js';import{fileTypeFromBuffer}from'file-type';import a0_0x42b000 from'node-webpmux';import a0_0x2b3995 from'node-fetch';const __dirname=dirname(fileURLToPath(import.meta[a0_0x3ef826(0x1d6)])),tmp=a0_0x17941c['join'](__dirname,a0_0x3ef826(0x222));function a0_0x31b7(_0xd26431,_0x46e81c){const _0x401a0a=a0_0x401a();return a0_0x31b7=function(_0x31b774,_0xe057c){_0x31b774=_0x31b774-0x1d6;let _0xdcc387=_0x401a0a[_0x31b774];return _0xdcc387;},a0_0x31b7(_0xd26431,_0x46e81c);}function sticker2(_0x12eba2,_0x5c1c9e){return new Promise(async(_0x18cb69,_0x4b51d4)=>{const _0x55d77b=a0_0x31b7;try{if(_0x5c1c9e){const _0x4d9316=await a0_0x2b3995(_0x5c1c9e);if(_0x4d9316['status']!==0xc8)throw await _0x4d9316['text']();_0x12eba2=await _0x4d9316[_0x55d77b(0x1db)]();}const _0x549ecc=a0_0x17941c['join'](tmp,+new Date()+_0x55d77b(0x1d8));await a0_0x49b4bb[_0x55d77b(0x1fd)][_0x55d77b(0x1ff)](_0x549ecc,_0x12eba2);const _0x42ce42=spawn('ffmpeg',['-y','-i',_0x549ecc,'-vf',_0x55d77b(0x21d),'-f',_0x55d77b(0x1e8),'-']);_0x42ce42['on'](_0x55d77b(0x1ee),_0x4b51d4),_0x42ce42['on']('close',async()=>{const _0x1c4c0e=_0x55d77b;await a0_0x49b4bb[_0x1c4c0e(0x1fd)][_0x1c4c0e(0x1f2)](_0x549ecc);});const _0x3afb7a=[],[_0xe66532,..._0x4e0e58]=[...module[_0x55d77b(0x20a)][_0x55d77b(0x1fe)]['gm']?['gm']:module['exports'][_0x55d77b(0x217)]?[_0x55d77b(0x217)]:[],_0x55d77b(0x224),'png:-',_0x55d77b(0x1e4)],_0xb08b9f=spawn(_0xe66532,_0x4e0e58);_0xb08b9f['on'](_0x55d77b(0x1ee),_0x2627ef=>conn[_0x55d77b(0x210)](m[_0x55d77b(0x20c)],util[_0x55d77b(0x206)](_0x2627ef),m)),_0xb08b9f[_0x55d77b(0x21e)]['on'](_0x55d77b(0x219),_0x1243fd=>_0x3afb7a[_0x55d77b(0x223)](_0x1243fd)),_0x42ce42[_0x55d77b(0x21e)][_0x55d77b(0x20b)](_0xb08b9f['stdin']),_0xb08b9f['on'](_0x55d77b(0x1f3),()=>{const _0x1606f3=_0x55d77b;_0x18cb69(Buffer[_0x1606f3(0x1f4)](_0x3afb7a));});}catch(_0x15d043){_0x4b51d4(_0x15d043);}});}async function sticker3(_0x33353f,_0x26904b,_0x417e40,_0x59ab2b){const _0xdc93c9=a0_0x3ef826;_0x26904b=_0x26904b?_0x26904b:await a0_0x369ab2(_0x33353f);const _0x173023=await a0_0x2b3995(_0xdc93c9(0x20e)+new URLSearchParams(Object[_0xdc93c9(0x208)]({'url':_0x26904b,'packname':_0x417e40,'author':_0x59ab2b})));return await _0x173023[_0xdc93c9(0x1db)]();}async function sticker4(_0x25f1dc,_0x2e1f47){const _0x384f8a=a0_0x3ef826;if(_0x2e1f47){const _0x5a66d2=await a0_0x2b3995(_0x2e1f47);if(_0x5a66d2[_0x384f8a(0x218)]!==0xc8)throw await _0x5a66d2[_0x384f8a(0x1e7)]();_0x25f1dc=await _0x5a66d2[_0x384f8a(0x1db)]();}return await ffmpeg(_0x25f1dc,['-vf','scale=512:512:flags=lanczos:force_original_aspect_ratio=decrease,format=rgba,pad=512:512:(ow-iw)/2:(oh-ih)/2:color=#00000000,setsar=1'],_0x384f8a(0x1e5),_0x384f8a(0x1f9));}async function sticker5(_0x27d25e,_0x1cdf6f,_0x3176b6,_0x9045bb,_0x325b99=[''],_0x34ced0={}){const _0x4b22e1=a0_0x3ef826,{Sticker:_0x288e05}=await import(_0x4b22e1(0x21b)),_0x11ed56={'type':_0x4b22e1(0x1ef),'pack':_0x3176b6,'author':_0x9045bb,'categories':_0x325b99,..._0x34ced0};return new _0x288e05(_0x27d25e?_0x27d25e:_0x1cdf6f,_0x11ed56)['toBuffer']();}function sticker6(_0x4f4960,_0x312c08){return new Promise(async(_0x49ecdb,_0x4f34fe)=>{const _0x39d2eb=a0_0x31b7;if(_0x312c08){const _0x5b82f7=await a0_0x2b3995(_0x312c08);if(_0x5b82f7[_0x39d2eb(0x218)]!==0xc8)throw await _0x5b82f7[_0x39d2eb(0x1e7)]();_0x4f4960=await _0x5b82f7[_0x39d2eb(0x1db)]();}const _0x205417=await fileTypeFromBuffer(_0x4f4960)||{'mime':_0x39d2eb(0x215),'ext':'bin'};if(_0x205417[_0x39d2eb(0x216)]==_0x39d2eb(0x1df))_0x4f34fe(_0x4f4960);const _0x445535=a0_0x17941c[_0x39d2eb(0x1e6)](__dirname,_0x39d2eb(0x21f)+ +new Date()+'.'+_0x205417[_0x39d2eb(0x216)]),_0x4dd195=a0_0x17941c['join'](_0x445535+_0x39d2eb(0x1fb));await a0_0x49b4bb['promises'][_0x39d2eb(0x1ff)](_0x445535,_0x4f4960);const _0x23027a=/video/i['test'](_0x205417[_0x39d2eb(0x1ea)])?a0_0x1f5747(_0x445535)[_0x39d2eb(0x213)](_0x205417['ext']):a0_0x1f5747(_0x445535)['input'](_0x445535);_0x23027a['on'](_0x39d2eb(0x1ee),function(_0x3f02fb){const _0x3a538d=_0x39d2eb;console[_0x3a538d(0x1ee)](_0x3f02fb),a0_0x49b4bb[_0x3a538d(0x1fd)]['unlink'](_0x445535),_0x4f34fe(_0x4f4960);})['on'](_0x39d2eb(0x203),async function(){const _0x82125b=_0x39d2eb;a0_0x49b4bb[_0x82125b(0x1fd)][_0x82125b(0x1f2)](_0x445535),_0x49ecdb(await a0_0x49b4bb[_0x82125b(0x1fd)]['readFile'](_0x4dd195));})[_0x39d2eb(0x1e1)](['-vcodec',_0x39d2eb(0x1f1),_0x39d2eb(0x20f),'scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse'])[_0x39d2eb(0x20d)]('webp')[_0x39d2eb(0x1d9)](_0x4dd195);});}async function addExif(_0x409eee,_0x1dd57d,_0x25cd33,_0x5dbde5=[''],_0x3c98dd){const _0x28fd3c=a0_0x3ef826,_0x263a37=new a0_0x42b000[(_0x28fd3c(0x214))](),_0x3e66d7='MYSTIC'+a0_0xff33a6[_0x28fd3c(0x1da)](0xc)[_0x28fd3c(0x1e3)](_0x28fd3c(0x1ec))[_0x28fd3c(0x205)](),_0x23d0ca={'sticker-pack-id':_0x3c98dd[_0x28fd3c(0x1e2)]?_0x3c98dd['packId']:''+_0x3e66d7,'sticker-pack-name':_0x1dd57d?_0x1dd57d:undefined,'sticker-pack-publisher':_0x25cd33?_0x25cd33:undefined,'android-app-store-link':_0x3c98dd['androidAppStoreLink']?_0x3c98dd[_0x28fd3c(0x212)]:undefined,'ios-app-store-link':_0x3c98dd[_0x28fd3c(0x1f0)]?_0x3c98dd[_0x28fd3c(0x1f0)]:undefined,'is-ai-sticker':_0x3c98dd[_0x28fd3c(0x1de)]?0x1:undefined,'is-first-party-sticker':_0x3c98dd[_0x28fd3c(0x202)]?0x1:undefined,'accessibility-text':_0x3c98dd[_0x28fd3c(0x1f6)]?_0x3c98dd['accessibilityText']:undefined,'avatar-sticker-template-id':_0x3c98dd[_0x28fd3c(0x21a)]?_0x3c98dd[_0x28fd3c(0x21a)]:undefined,'is-avatar-sticker':_0x3c98dd['isAvatarSticker']?0x1:undefined,'sticker-maker-source-type':_0x3c98dd[_0x28fd3c(0x1dd)]?_0x3c98dd['stickerMakerSourceType']:undefined,'emojis':_0x5dbde5?_0x5dbde5:undefined},_0x56d7dd=Buffer['from']([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x2199f8=Buffer['from'](JSON[_0x28fd3c(0x1f8)](_0x23d0ca),'utf8'),_0x2930c6=Buffer['concat']([_0x56d7dd,_0x2199f8]);return _0x2930c6[_0x28fd3c(0x207)](_0x2199f8[_0x28fd3c(0x220)],0xe,0x4),await _0x263a37[_0x28fd3c(0x211)](_0x409eee),_0x263a37[_0x28fd3c(0x1ed)]=_0x2930c6,await _0x263a37[_0x28fd3c(0x1d9)](null);}async function sticker(_0x1b8153,_0x4f0e36,..._0x31ecdd){const _0x1d6f19=a0_0x3ef826;let _0x38b749,_0x26ec6b;for(const _0x20801f of[sticker3,global[_0x1d6f19(0x1fe)][_0x1d6f19(0x1fc)]&&sticker6,sticker5,global[_0x1d6f19(0x1fe)]['ffmpeg']&&global[_0x1d6f19(0x1fe)][_0x1d6f19(0x1fa)]&&sticker4,global[_0x1d6f19(0x1fe)]['ffmpeg']&&(global[_0x1d6f19(0x1fe)]['convert']||global[_0x1d6f19(0x1fe)][_0x1d6f19(0x217)]||global[_0x1d6f19(0x1fe)]['gm'])&&sticker2]['filter'](_0x34064d=>_0x34064d)){try{_0x26ec6b=await _0x20801f(_0x1b8153,_0x4f0e36,..._0x31ecdd);if(_0x26ec6b[_0x1d6f19(0x1d7)](_0x1d6f19(0x221)))continue;if(_0x26ec6b[_0x1d6f19(0x1d7)]('WEBP'))try{return await addExif(_0x26ec6b,..._0x31ecdd);}catch(_0x1a2c62){return console['error'](_0x1a2c62),_0x26ec6b;}throw _0x26ec6b[_0x1d6f19(0x1e3)]();}catch(_0x746d9f){_0x38b749=_0x746d9f;continue;}}return console['error'](_0x38b749),_0x38b749;}const support={'ffmpeg':!![],'ffprobe':!![],'ffmpegWebp':!![],'convert':!![],'magick':![],'gm':![],'find':![]};export{sticker,sticker2,sticker3,sticker4,sticker6,addExif,support};